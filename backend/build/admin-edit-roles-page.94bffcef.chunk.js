(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[2544],{23341:(w,z,a)=>{"use strict";a.r(z),a.d(z,{CreatePage:()=>Ae,default:()=>Ve});var e=a(67294),T=a(185),k=a(53979),S=a(11047),B=a(29728),D=a(49066),A=a(41580),$=a(75515),N=a(11276),q=a(67819),i=a(16364),W=a(61467),C=a(60698),Re=a(67109),xe=a(6406),y=a(14916),O=a(27361),J=a.n(O),Me=a(41609),Se=a.n(Me),$e=a(86896),b=a(16550),ke=a(71997),Q=a(51319),_=a(87751),ge=a(18280),de=a(87561);const fe=de.Ry().shape({name:de.Z_().required(C.I0.required),description:de.Z_().required(C.I0.required)}),he=ke.ZP.div`
  border: 1px solid ${({theme:V})=>V.colors.primary200};
  background: ${({theme:V})=>V.colors.primary100};
  padding: ${({theme:V})=>`${V.spaces[2]} ${V.spaces[4]}`};
  color: ${({theme:V})=>V.colors.primary600};
  border-radius: ${({theme:V})=>V.borderRadius};
  font-size: ${12/16}rem;
  font-weight: bold;
`,Ae=()=>{const V=(0,C.lm)(),{lockApp:j,unlockApp:K}=(0,C.o1)(),{formatMessage:M}=(0,$e.Z)(),[ee,te]=(0,e.useState)(!1),{replace:ie}=(0,b.k6)(),H=(0,e.useRef)(),{trackUsage:ue}=(0,C.rS)(),le=(0,b.$B)("/settings/roles/duplicate/:id"),ye=J()(le,"params.id",null),{isLoading:Le,data:ae}=(0,Q.U_)(),{permissions:De,isLoading:Ce}=(0,Q.Dq)(ye),{post:je,put:Pe}=(0,C.kY)(),Ze=ne=>{j(),te(!0),ue(ye?"willDuplicateRole":"willCreateNewRole"),Promise.resolve(je("/admin/roles",ne)).then(async({data:Z})=>{const{permissionsToSend:U}=H.current.getPermissions();return ue(ye?"didDuplicateRole":"didCreateNewRole"),Z.data.id&&!Se()(U)&&await Pe(`/admin/roles/${Z.data.id}/permissions`,{permissions:U}),Z}).then(Z=>{te(!1),V({type:"success",message:{id:"Settings.roles.created",defaultMessage:"created"}}),ie(`/settings/roles/${Z.data.id}`)}).catch(Z=>{console.error(Z),te(!1),V({type:"warning",message:{id:"notification.error"}})}).finally(()=>{K()})},Ie=`${M({id:"Settings.roles.form.created",defaultMessage:"Created"})} ${(0,xe.Z)(new Date,"PPP")}`;return e.createElement(T.o,null,e.createElement(C.SL,{name:"Roles"}),e.createElement(y.J9,{initialValues:{name:"",description:Ie},onSubmit:Ze,validationSchema:fe,validateOnChange:!1},({handleSubmit:ne,values:Z,errors:U,handleReset:se,handleChange:me})=>e.createElement(C.l0,{noValidate:!0},e.createElement(e.Fragment,null,e.createElement(k.T,{primaryAction:e.createElement(S.k,{gap:2},e.createElement(B.z,{variant:"secondary",onClick:()=>{se(),H.current.resetForm()},size:"L"},M({id:"app.components.Button.reset",defaultMessage:"Reset"})),e.createElement(B.z,{onClick:ne,loading:ee,size:"L"},M({id:"global.save",defaultMessage:"Save"}))),title:M({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:M({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(C.rU,{startIcon:e.createElement(Re.Z,null),to:"/settings/roles"},M({id:"global.back",defaultMessage:"Back"}))}),e.createElement(D.D,null,e.createElement(S.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(A.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(S.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(S.k,{justifyContent:"space-between"},e.createElement(A.x,null,e.createElement(A.x,null,e.createElement($.Z,{fontWeight:"bold"},M({id:"global.details",defaultMessage:"Details"}))),e.createElement(A.x,null,e.createElement($.Z,{variant:"pi",textColor:"neutral600"},M({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement(he,null,M({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:0}))),e.createElement(N.r,{gap:4},e.createElement(q.P,{col:6},e.createElement(i.o,{name:"name",error:U.name&&M({id:U.name}),label:M({id:"global.name",defaultMessage:"Name"}),onChange:me,value:Z.name})),e.createElement(q.P,{col:6},e.createElement(W.g,{label:M({id:"global.description",defaultMessage:"Description"}),id:"description",error:U.description&&M({id:U.description}),onChange:me},Z.description))))),!Le&&!Ce?e.createElement(A.x,{shadow:"filterShadow",hasRadius:!0},e.createElement(ge.Z,{isFormDisabled:!1,ref:H,permissions:De,layout:ae})):e.createElement(A.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(C.dO,null))))))))};function Ve(){return e.createElement(C.O4,{permissions:_.Z.settings.roles.create},e.createElement(Ae,null))}},18280:(w,z,a)=>{"use strict";a.d(z,{Z:()=>es});var e=a(67294),T=a(82777),k=a(77296),S=a(42761),B=a(60698),D=a(18721),A=a.n(D),$=a(41609),N=a.n($),q=a(45697),i=a.n(q),W=a(86896),C=a(41580),Re=a(89734),xe=a.n(Re),y=a(71997),O=a(11047),J=a(92155),Me=a(52337),Se=a(66942),$e=a(27361),b=a.n($e),ke=a(57557),Q=a.n(ke),_=a(51319),ge=a(29728),de=a(78114);const We=y.ZP.div`
  position: relative;

  ${({hasConditions:t,disabled:n,theme:o})=>t&&`
    &:before {
      content: '';
      position: absolute;
      top: -3px;
      left: -10px;
      width: 6px;
      height: 6px;
      border-radius: ${20/16}rem;;
      background: ${n?o.colors.neutral100:o.colors.primary600};
    }
  `}
`,fe=({onClick:t,className:n,hasConditions:o,variant:s})=>{const{formatMessage:r}=(0,W.Z)();return e.createElement(We,{hasConditions:o,className:n},e.createElement(ge.z,{variant:s,startIcon:e.createElement(de.Z,null),onClick:t},r({id:"global.settings",defaultMessage:"Settings"})))};fe.defaultProps={className:null,hasConditions:!1,variant:"tertiary"},fe.propTypes={onClick:i().func.isRequired,className:i().string,hasConditions:i().bool,variant:i().string};const he=(0,y.ZP)(fe)``;var Ae=a(42866),Ve=a(24969),V=a(59946),j=a(75515),K=a(36856),M=a(63321),ee=a(36773),te=a(18172),ie=a(7739),H=a.n(ie),ue=a(11700),le=a.n(ue),ye=a(38953);const Le=t=>Object.values(t).map(n=>Object.entries(n).filter(([,o])=>o).map(([o])=>o)).flat(),ae=t=>t.reduce((n,[o,s])=>(n.push({label:le()(o),children:s.map(r=>({label:r.displayName,value:r.id}))}),n),[]),De=(t,n)=>t.map(([,o])=>o).flat().reduce((o,s)=>({[s.id]:n.includes(s.id),...o}),{}),Ce=({arrayOfOptionsGroupedByCategory:t,isFormDisabled:n,isGrey:o,label:s,name:r,onChange:l,value:c})=>{const{formatMessage:d}=(0,W.Z)(),m=u=>{l(r,De(t,u))};return e.createElement(O.k,{as:"li",background:o?"neutral100":"neutral0",paddingBottom:3,paddingTop:3},e.createElement(O.k,{paddingLeft:6,style:{width:180}},e.createElement(j.Z,{variant:"sigma",textColor:"neutral600"},d({id:"Settings.permissions.conditions.can",defaultMessage:"Can"}),"\xA0"),e.createElement(j.Z,{variant:"sigma",title:s,textColor:"primary600",ellipsis:!0},d({id:`Settings.roles.form.permissions.${s.toLowerCase()}`,defaultMessage:s})),e.createElement(j.Z,{variant:"sigma",textColor:"neutral600"},"\xA0",d({id:"Settings.permissions.conditions.when",defaultMessage:"When"}))),e.createElement(C.x,{style:{maxWidth:430,width:"100%"}},e.createElement(ye.Q,{id:r,customizeContent:u=>`${u.length} currently selected`,onChange:m,value:Le(c),options:ae(t),disabled:n})))};Ce.propTypes={arrayOfOptionsGroupedByCategory:i().array.isRequired,isFormDisabled:i().bool.isRequired,isGrey:i().bool.isRequired,label:i().string.isRequired,name:i().string.isRequired,value:i().object.isRequired,onChange:i().func.isRequired};const je=Ce,Pe=(t,n)=>t.reduce((o,s)=>(o[s.id]=b()(n,s.id,!1),o),{}),Ze=(t,n)=>t.reduce((o,s)=>{const[r,l]=s,c=Pe(l,n);return o[r]=c,o},{}),ne=(t,n,o)=>t.reduce((s,r)=>{const l=b()(n,[...r.pathToConditionsObject,"conditions"],{}),c=Ze(o,l);return s[r.pathToConditionsObject.join("..")]=c,s},{}),Z=({actions:t,headerBreadCrumbs:n,isFormDisabled:o,onClosed:s,onToggle:r})=>{const{formatMessage:l}=(0,W.Z)(),{availableConditions:c,modifiedData:d,onChangeConditions:m}=(0,_.$_)(),u=(0,e.useMemo)(()=>Object.entries(H()(c,"category")),[c]),p=t.filter(({isDisplayed:g,hasSomeActionsSelected:x,hasAllActionsSelected:v})=>g&&(x||v)),f=(0,e.useMemo)(()=>ne(p,d,u),[p,d,u]),[E,L]=(0,e.useState)(f),R=(g,x)=>{L((0,te.ZP)(v=>{v[g]||(v[g]={}),v[g].default||(v[g].default={}),v[g].default=x}))},h=()=>{const g=Object.entries(E).reduce((x,v)=>{const[P,X]=v,F=Object.values(X).reduce((G,I)=>({...G,...I}),{});return x[P]=F,x},{});m(g),r()};return e.createElement(Ae.P,{labelledBy:"condition-modal-breadcrumbs",onClose:s},e.createElement(Ve.x,null,e.createElement(M.O,{id:"condition-modal-breadcrumbs",label:n.join(", ")},n.map((g,x,v)=>e.createElement(ee.$,{isCurrent:x===v.length-1,key:g},le()(l({id:g,defaultMessage:g})))))),e.createElement(V.f,null,p.length===0&&e.createElement(j.Z,null,l({id:"Settings.permissions.conditions.no-actions",defaultMessage:"You first need to select actions (create, read, update, ...) before defining conditions on them."})),e.createElement("ul",null,p.map(({actionId:g,label:x,pathToConditionsObject:v},P)=>{const X=v.join("..");return e.createElement(je,{key:g,arrayOfOptionsGroupedByCategory:u,label:x,isFormDisabled:o,isGrey:P%2===0,name:X,onChange:R,value:b()(E,X,{})})}))),e.createElement(K.m,{startActions:e.createElement(ge.z,{variant:"tertiary",onClick:r},l({id:"app.components.Button.cancel",defaultMessage:"Cancel"})),endActions:e.createElement(ge.z,{onClick:h},l({id:"Settings.permissions.conditions.apply",defaultMessage:"Apply"}))}))};Z.propTypes={actions:i().arrayOf(i().shape({actionId:i().string.isRequired,checkboxName:i().string,hasSomeActionsSelected:i().bool.isRequired,hasAllActionsSelected:i().bool,isDisplayed:i().bool.isRequired,label:i().string})).isRequired,headerBreadCrumbs:i().arrayOf(i().string).isRequired,isFormDisabled:i().bool.isRequired,onClosed:i().func.isRequired,onToggle:i().func.isRequired};const U=Z,se=`${120/16}rem`,me=`${200/16}rem`,He=`${53/16}rem`,Ke=y.ZP.div`
  width: ${se};
`,ot=(0,y.ZP)(O.k)`
  padding-right: ${({theme:t})=>t.spaces[2]};
  overflow: hidden;
  flex: 1;
  ${({isCollapsable:t})=>t&&"cursor: pointer;"}
`,Ue=({children:t,isCollapsable:n,isActive:o,isFormDisabled:s,label:r,onChange:l,onClick:c,checkboxName:d,someChecked:m,value:u})=>{const{formatMessage:p}=(0,W.Z)();return e.createElement(O.k,{alignItems:"center",paddingLeft:6,style:{width:me,flexShrink:0}},e.createElement(C.x,{paddingRight:2},e.createElement(J.C,{name:d,"aria-label":p({id:"Settings.permissions.select-all-by-permission",defaultMessage:"Select all {label} permissions"},{label:r}),disabled:s,onValueChange:f=>l({target:{name:d,value:f}}),indeterminate:m,value:u})),e.createElement(ot,{title:r,alignItems:"center",isCollapsable:n,...n&&{onClick:c,"aria-expanded":o,onKeyDown:({key:f})=>(f==="Enter"||f===" ")&&c(),tabIndex:0,role:"button"}},e.createElement(j.Z,{fontWeight:o?"bold":"",textColor:o?"primary600":"neutral800",ellipsis:!0},le()(r)),t))};Ue.defaultProps={children:null,checkboxName:"",onChange(){},value:!1,someChecked:!1,isCollapsable:!1},Ue.propTypes={checkboxName:i().string,children:i().node,label:i().string.isRequired,isCollapsable:i().bool,isFormDisabled:i().bool.isRequired,onChange:i().func,onClick:i().func.isRequired,someChecked:i().bool,value:i().bool,isActive:i().bool.isRequired};const rt=(0,e.memo)(Ue);var Bt=a(42348),Nt=a.n(Bt),Vt=a(13218),pe=a.n(Vt);const it=t=>pe()(t)?Nt()(Object.values(t).map(n=>pe()(n)?it(n):n)):[],Te=it,ze=t=>t?Object.keys(t).reduce((n,o)=>(o!=="conditions"&&(n[o]=t[o]),n),{}):null,be=t=>{const n=ze(t),o=Te(n);if(!o.length)return{hasAllActionsSelected:!1,hasSomeActionsSelected:!1};const s=o.every(l=>l),r=o.some(l=>l)&&!s;return{hasAllActionsSelected:s,hasSomeActionsSelected:r}};var Ht=a(12645);const Fe=(0,y.ZP)(Ht.Z)`
  display: none;
  width: ${10/16}rem;
  transform: rotate(${({$isActive:t})=>t?"180":"0"}deg);
  margin-left: ${({theme:t})=>t.spaces[2]};
`,Be=t=>`
  ${j.Z} {
    color: ${t.colors.primary600};
    font-weight: ${t.fontWeights.bold}
  }
  ${Fe} {
    display: block;
    path {
      fill: ${t.colors.primary600}
    };
  }
`,Gt=(t,n,o)=>t.map(({actionId:s,isDisplayed:r,applyToProperties:l,label:c})=>{if(!r)return{actionId:s,hasSomeActionsSelected:!1,isDisplayed:r};const d=[...o.split(".."),s],m=N()(l)?[...d,"properties","enabled"]:d,u=m.join(".."),p=b()(n,[...d,"conditions"],null),f=Te(p).some(h=>h);if(N()(l)){const h=b()(n,m,!1);return{actionId:s,checkboxName:u,hasAllActionsSelected:h,hasConditions:f,hasSomeActionsSelected:h,isDisplayed:r,isParentCheckbox:!1,label:c,pathToConditionsObject:d}}const E=b()(n,m,null),{hasAllActionsSelected:L,hasSomeActionsSelected:R}=be(E);return{actionId:s,checkboxName:u,hasAllActionsSelected:L,hasConditions:f,hasSomeActionsSelected:R,isDisplayed:r,isParentCheckbox:!0,label:c,pathToConditionsObject:d}}),Xe=(t,n)=>`
  ${at} {
    background-color: ${t.colors.primary100};
    color: ${t.colors.primary600};
    border-radius: ${n?"2px 2px 0 0":"2px"};
  }
  ${ct} {
    display: flex;
  }
  ${he} {
    display: block;
  }
  &:hover {
   ${Be(t)}
  }

  &:focus-within {
    ${({theme:o,isActive:s})=>Xe(o,s)}
  }
  
`,at=y.ZP.div`
  flex: 1;
  display: flex;
  align-items: center;
  height: ${He};
  background-color: ${({isGrey:t,theme:n})=>t?n.colors.neutral100:n.colors.neutral0};
  border: 1px solid transparent;
`,Wt=y.ZP.div`
  display: inline-flex;
  min-width: 100%;

  ${he} {
    display: none;
  }
  ${({isActive:t,theme:n})=>t&&Xe(n,t)}
  &:hover {
    ${({theme:t,isActive:n})=>Xe(t,n)}
  }
`,lt=(0,y.ZP)(O.k)`
  width: ${se};
  position: relative;
`,ct=(0,y.ZP)(C.x)`
  display: none;
  svg {
    width: 11px;
  }
  * {
    fill: ${({theme:t})=>t.colors.primary600};
  }
`,dt=y.ZP.span`
  position: absolute;
  top: -6px;
  left: 37px;
  width: 6px;
  height: 6px;
  border-radius: 20px;
  background: ${({theme:t})=>t.colors.primary600};
`,Kt=(0,y.ZP)(C.x)`
  position: absolute;
  right: 9px;
  transform: translateY(10px);
`,ut=({availableActions:t,isActive:n,isGrey:o,isFormDisabled:s,label:r,onClickToggle:l,pathToData:c})=>{const[d,m]=(0,e.useState)(!1),{formatMessage:u}=(0,W.Z)(),{modifiedData:p,onChangeParentCheckbox:f,onChangeSimpleCheckbox:E}=(0,_.$_)(),L=()=>{m(F=>!F)},R=()=>{m(!1)},h=b()(p,c.split(".."),{}),g=(0,e.useMemo)(()=>Object.keys(h).reduce((F,G)=>(F[G]=Q()(h[G],"conditions"),F),{}),[h]),{hasAllActionsSelected:x,hasSomeActionsSelected:v}=be(g),P=(0,e.useMemo)(()=>Gt(t,p,c),[t,p,c]),X=P.some(({hasConditions:F})=>F);return e.createElement(Wt,{isActive:n},e.createElement(at,{isGrey:o},e.createElement(rt,{isCollapsable:!0,isFormDisabled:s,label:r,checkboxName:c,onChange:f,onClick:l,someChecked:v,value:x,isActive:n},e.createElement(ct,{paddingLeft:2},n?e.createElement(Me.Z,null):e.createElement(Se.Z,null))),e.createElement(O.k,{style:{flex:1}},P.map(({actionId:F,hasConditions:G,hasAllActionsSelected:I,hasSomeActionsSelected:re,isDisplayed:Oe,isParentCheckbox:Y,checkboxName:ce,label:Ne})=>Oe?Y?e.createElement(lt,{key:F,justifyContent:"center",alignItems:"center"},G&&e.createElement(dt,null),e.createElement(J.C,{disabled:s,name:ce,"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${Ne} ${r}`}),onValueChange:Ee=>{f({target:{name:ce,value:Ee}})},indeterminate:re,value:I})):e.createElement(lt,{key:F,justifyContent:"center",alignItems:"center"},G&&e.createElement(dt,null),e.createElement(J.C,{disabled:s,indeterminate:G,name:ce,onValueChange:Ee=>{E({target:{name:ce,value:Ee}})},value:I})):e.createElement(Ke,{key:F}))),d&&e.createElement(U,{headerBreadCrumbs:[r,"Settings.permissions.conditions.conditions"],actions:P,isFormDisabled:s,onClosed:R,onToggle:L})),e.createElement(Kt,null,e.createElement(he,{onClick:L,hasConditions:X})))};ut.propTypes={availableActions:i().array.isRequired,isActive:i().bool.isRequired,isGrey:i().bool.isRequired,isFormDisabled:i().bool.isRequired,label:i().string.isRequired,onClickToggle:i().func.isRequired,pathToData:i().string.isRequired};const Ut=ut,zt=y.ZP.span`
  color: ${({theme:t})=>t.colors.danger700};
  padding-left: ${({theme:t})=>t.spaces[1]}px;
`,mt=()=>e.createElement(zt,null,"*"),Xt=(t,n)=>t.map(o=>{const s=Array.isArray(o.subjects)&&o.subjects.indexOf(n)!==-1;return{...o,isDisplayed:s}}),Yt=(0,y.ZP)(C.x)`
  transform: translate(-4px, -12px);

  &:before {
    content: '';
    width: ${4/16}rem;
    height: ${12/16}rem;
    background: ${({theme:t})=>t.colors.primary200};
    display: block;
  }
`,wt=y.ZP.svg`
  position: relative;
  flex-shrink: 0;
  transform: translate(-0.5px, -1px);

  * {
    fill: ${({theme:t,color:n})=>t.colors[n]};
  }
`,Ye=t=>e.createElement(Yt,null,e.createElement(wt,{width:"20",height:"23",viewBox:"0 0 20 23",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},e.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M7.02477 14.7513C8.65865 17.0594 11.6046 18.6059 17.5596 18.8856C18.6836 18.9384 19.5976 19.8435 19.5976 20.9688V20.9688C19.5976 22.0941 18.6841 23.0125 17.5599 22.9643C10.9409 22.6805 6.454 20.9387 3.75496 17.1258C0.937988 13.1464 0.486328 7.39309 0.486328 0.593262H4.50974C4.50974 7.54693 5.06394 11.9813 7.02477 14.7513Z",fill:"#D9D8FF"})));Ye.defaultProps={fill:"primary200"},Ye.propTypes={fill:i().string};const qt=(0,e.memo)(Ye),pt=(0,y.ZP)(O.k)`
  width: ${se};
  position: relative;
`,Jt=(0,y.ZP)(O.k)`
  height: ${He};
`,Qt=(0,y.ZP)(C.x)`
  padding-left: ${31/16}rem;
`,_t=(0,y.ZP)(C.x)`
  border-left: ${({isVisible:t,theme:n})=>t?`4px solid ${n.colors.primary200}`:"4px solid transparent"};
`,en=(0,y.ZP)(O.k)`
  padding-left: ${({theme:t})=>t.spaces[4]};
  width: ${({level:t})=>145-t*36}px;

  ${({isCollapsable:t,theme:n})=>t&&`
      ${Fe} {
        display: block;
        color: ${n.colors.neutral100};
      }
      &:hover {
        ${Be(n)}
      }
  `}
  ${({isActive:t,theme:n})=>t&&Be(n)};
`,tn=y.ZP.div`
  padding-top: ${({theme:t})=>t.spaces[2]};
  margin-top: ${({theme:t})=>t.spaces[2]};
  width: ${4/16}rem;
  background-color: ${({theme:t})=>t.colors.primary200};
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
`,we=({childrenForm:t,isFormDisabled:n,recursiveLevel:o,pathToDataFromActionRow:s,propertyActions:r,parentName:l,propertyName:c})=>{const{formatMessage:d}=(0,W.Z)(),{modifiedData:m,onChangeParentCheckbox:u,onChangeSimpleCheckbox:p}=(0,_.$_)(),[f,E]=(0,e.useState)(null),L=h=>{E(g=>g===h?null:h)},R=(0,e.useMemo)(()=>f?t.find(({value:h})=>h===f):null,[f,t]);return e.createElement(Qt,null,e.createElement(tn,null),t.map(({label:h,value:g,required:x,children:v},P)=>{const X=P+1<t.length,F=Array.isArray(v),G=f===g;return e.createElement(_t,{key:g,isVisible:X},e.createElement(Jt,null,e.createElement(qt,{color:"primary200"}),e.createElement(O.k,{style:{flex:1}},e.createElement(en,{level:o,isActive:G,isCollapsable:F},e.createElement(ot,{alignItems:"center",isCollapsable:F,...F&&{onClick:()=>L(g),"aria-expanded":G,onKeyDown:({key:I})=>(I==="Enter"||I===" ")&&L(g),tabIndex:0,role:"button"},title:h},e.createElement(j.Z,{ellipsis:!0},le()(h)),x&&e.createElement(mt,null),e.createElement(Fe,{$isActive:G}))),e.createElement(O.k,{style:{flex:1}},r.map(({actionId:I,label:re,isActionRelatedToCurrentProperty:Oe})=>{if(!Oe)return e.createElement(Ke,{key:I});const Y=[...s.split(".."),I,"properties",c,...l.split(".."),g],ce=b()(m,Y,!1);if(!v)return e.createElement(pt,{key:re,justifyContent:"center",alignItems:"center"},e.createElement(J.C,{disabled:n,name:Y.join(".."),"aria-label":d({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${l} ${h} ${re}`}),onValueChange:ve=>{p({target:{name:Y.join(".."),value:ve}})},value:ce}));const{hasAllActionsSelected:Ne,hasSomeActionsSelected:Ee}=be(ce);return e.createElement(pt,{key:re,justifyContent:"center",alignItems:"center"},e.createElement(J.C,{key:re,disabled:n,name:Y.join(".."),"aria-label":d({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${l} ${h} ${re}`}),onValueChange:ve=>{u({target:{name:Y.join(".."),value:ve}})},value:Ne,indeterminate:Ee}))})))),R&&G&&e.createElement(C.x,{paddingBottom:2},e.createElement(we,{isFormDisabled:n,parentName:`${l}..${g}`,pathToDataFromActionRow:s,propertyActions:r,propertyName:c,recursiveLevel:o+1,childrenForm:R.children})))}))};we.propTypes={childrenForm:i().array.isRequired,isFormDisabled:i().bool.isRequired,parentName:i().string.isRequired,pathToDataFromActionRow:i().string.isRequired,propertyActions:i().array.isRequired,propertyName:i().string.isRequired,recursiveLevel:i().number.isRequired};const nn=(0,e.memo)(we),sn=t=>t.reduce((o,s)=>(s.isActionRelatedToCurrentProperty&&o.push(s.actionId),o),[]),on=(t,n,o,s,r)=>{const c=sn(t).reduce((d,m)=>{const u=[...o.split(".."),m,"properties",s,r],p=b()(n,u,!1);return d[m]=p,d},{});return be(c)},gt=(0,y.ZP)(O.k)`
  width: ${se};
  position: relative;
`,rn=(0,y.ZP)(O.k)`
  height: ${He};
  flex: 1;

  ${({isCollapsable:t,theme:n})=>t&&`
      ${Fe} {
        display: block;
        color: ${n.colors.neutral100};
      }
      &:hover {
        ${Be(n)}
      }
  `}
  ${({isActive:t,theme:n})=>t&&Be(n)};
`,qe=({childrenForm:t,label:n,isFormDisabled:o,name:s,required:r,pathToData:l,propertyActions:c,propertyName:d,isOdd:m})=>{const{formatMessage:u}=(0,W.Z)(),[p,f]=(0,e.useState)(null),{modifiedData:E,onChangeCollectionTypeLeftActionRowCheckbox:L,onChangeParentCheckbox:R,onChangeSimpleCheckbox:h}=(0,_.$_)(),g=p===s,x=(0,e.useMemo)(()=>Array.isArray(t)?t:[],[t]),v=x.length>0,P=(0,e.useCallback)(()=>{v&&f(I=>I===s?null:s)},[v,s]),X=({target:{value:I}})=>{L(l,d,s,I)},{hasAllActionsSelected:F,hasSomeActionsSelected:G}=(0,e.useMemo)(()=>on(c,E,l,d,s),[c,E,l,d,s]);return e.createElement(e.Fragment,null,e.createElement(rn,{alignItems:"center",isCollapsable:v,isActive:g,background:m?"neutral100":"neutral0"},e.createElement(O.k,null,e.createElement(rt,{onChange:X,onClick:P,isCollapsable:v,isFormDisabled:o,label:n,someChecked:G,value:F,isActive:g},r&&e.createElement(mt,null),e.createElement(Fe,{$isActive:g})),e.createElement(O.k,null,c.map(({label:I,isActionRelatedToCurrentProperty:re,actionId:Oe})=>{if(!re)return e.createElement(Ke,{key:I});const Y=[...l.split(".."),Oe,"properties",d,s];if(!v){const ve=b()(E,Y,!1);return e.createElement(gt,{key:Oe,justifyContent:"center",alignItems:"center"},e.createElement(J.C,{disabled:o,name:Y.join(".."),"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${s} ${I}`}),onValueChange:ts=>{h({target:{name:Y.join(".."),value:ts}})},value:ve}))}const ce=b()(E,Y,{}),{hasAllActionsSelected:Ne,hasSomeActionsSelected:Ee}=be(ce);return e.createElement(gt,{key:I,justifyContent:"center",alignItems:"center"},e.createElement(J.C,{disabled:o,name:Y.join(".."),onValueChange:ve=>{R({target:{name:Y.join(".."),value:ve}})},"aria-label":u({id:"Settings.permissions.select-by-permission",defaultMessage:"Select {label} permission"},{label:`${s} ${I}`}),value:Ne,indeterminate:Ee}))})))),g&&e.createElement(nn,{childrenForm:x,isFormDisabled:o,parentName:s,pathToDataFromActionRow:l,propertyName:d,propertyActions:c,recursiveLevel:0}))};qe.defaultProps={childrenForm:[],required:!1},qe.propTypes={childrenForm:i().array,label:i().string.isRequired,isFormDisabled:i().bool.isRequired,name:i().string.isRequired,pathToData:i().string.isRequired,propertyActions:i().array.isRequired,propertyName:i().string.isRequired,required:i().bool,isOdd:i().bool.isRequired};const an=(0,e.memo)(qe),ft=(0,y.ZP)(O.k)`
  width: ${se};
  flex-shrink: 0;
`,ln=(0,y.ZP)(O.k)`
  width: ${me};
  height: ${He};
  flex-shrink: 0;
`,ht=({headers:t,label:n})=>{const{formatMessage:o}=(0,W.Z)(),s=o({id:"Settings.roles.form.permission.property-label",defaultMessage:"{label} permissions"},{label:n});return e.createElement(O.k,null,e.createElement(ln,{alignItems:"center",paddingLeft:6},e.createElement(j.Z,{variant:"sigma",textColor:"neutral500"},s)),t.map(r=>r.isActionRelatedToCurrentProperty?e.createElement(ft,{justifyContent:"center",key:r.label},e.createElement(j.Z,{variant:"sigma",textColor:"neutral500"},o({id:`Settings.roles.form.permissions.${r.label.toLowerCase()}`,defaultMessage:r.label}))):e.createElement(ft,{key:r.label})))};ht.propTypes={headers:i().arrayOf(i().shape({label:i().string.isRequired,isActionRelatedToCurrentProperty:i().bool.isRequired})).isRequired,label:i().string.isRequired};const cn=ht,dn=(t,n)=>t.map(o=>{const s=Array.isArray(o.applyToProperties)&&o.applyToProperties.indexOf(n)!==-1&&o.isDisplayed;return{label:o.label,actionId:o.actionId,isActionRelatedToCurrentProperty:s}}),un=y.ZP.div`
  display: inline-flex;
  flex-direction: column;
  min-width: 0;
`,yt=({availableActions:t,childrenForm:n,isFormDisabled:o,label:s,pathToData:r,propertyName:l})=>{const c=(0,e.useMemo)(()=>dn(t,l),[t,l]);return e.createElement(un,null,e.createElement(cn,{label:s,headers:c}),e.createElement(C.x,null,n.map(({children:d,label:m,value:u,required:p},f)=>e.createElement(an,{childrenForm:d,key:u,label:m,isFormDisabled:o,name:u,required:p,propertyActions:c,pathToData:r,propertyName:l,isOdd:f%2===0}))))};yt.propTypes={childrenForm:i().array.isRequired,availableActions:i().array.isRequired,isFormDisabled:i().bool.isRequired,label:i().string.isRequired,pathToData:i().string.isRequired,propertyName:i().string.isRequired};const mn=yt,pn=y.ZP.div`
  flex-direction: column;
  display: inline-flex;
  min-width: 100%;
  ${({theme:t,isActive:n})=>n&&`border: 1px solid ${t.colors.primary600};`}
`,Ct=({allActions:t,contentTypeName:n,label:o,index:s,isActive:r,isFormDisabled:l,onClickToggleCollapse:c,pathToData:d,properties:m})=>{const u=(0,e.useCallback)(()=>{c(n)},[n,c]),p=(0,e.useMemo)(()=>Xt(t,n),[t,n]);return e.createElement(pn,{isActive:r},e.createElement(Ut,{availableActions:p,isActive:r,isGrey:s%2===0,isFormDisabled:l,label:o,onClickToggle:u,pathToData:d}),r&&m.map(({label:f,value:E,children:L})=>e.createElement(mn,{availableActions:p,childrenForm:L,isFormDisabled:l,label:f,pathToData:d,propertyName:E,key:E})))};Ct.propTypes={allActions:i().array.isRequired,contentTypeName:i().string.isRequired,index:i().number.isRequired,isActive:i().bool.isRequired,isFormDisabled:i().bool.isRequired,label:i().string.isRequired,onClickToggleCollapse:i().func.isRequired,pathToData:i().string.isRequired,properties:i().array.isRequired};const gn=Ct,Je=({actions:t,isFormDisabled:n,pathToData:o,subjects:s})=>{const[r,l]=(0,e.useState)(null),c=d=>{l(r===d?null:d)};return s.map(({uid:d,label:m,properties:u},p)=>e.createElement(gn,{allActions:t,key:d,contentTypeName:d,label:m,isActive:r===d,isFormDisabled:n,index:p,onClickToggleCollapse:c,pathToData:`${o}..${d}`,properties:u}))};Je.defaultProps={actions:[],subjects:[]},Je.propTypes={actions:i().array.isRequired,isFormDisabled:i().bool.isRequired,pathToData:i().string.isRequired,subjects:i().arrayOf(i().shape({uid:i().string.isRequired,label:i().string.isRequired,properties:i().array.isRequired}))};const fn=(0,e.memo)(Je),hn=t=>t.filter(({subjects:n})=>n&&n.length),yn=t=>t.map(({actionId:n})=>n),Cn=(t,n)=>t.reduce((o,s)=>(Object.keys(n).forEach(r=>{const l=b()(n,[r,s],{}),c={[r]:ze(l)};o[s]?o[s]={...o[s],...c}:o[s]=c}),o),{}),bn=(t,n)=>{const o=yn(t),s=Cn(o,n);return Object.keys(s).reduce((l,c)=>(l[c]=be(s[c]),l),{})},En=(0,y.ZP)(O.k)`
  width: ${se};
  flex-shrink: 0;
`,Qe=({actions:t,isFormDisabled:n,kind:o})=>{const{formatMessage:s}=(0,W.Z)(),{modifiedData:r,onChangeCollectionTypeGlobalActionCheckbox:l}=(0,_.$_)(),c=(0,e.useMemo)(()=>hn(t),[t]),d=(0,e.useMemo)(()=>bn(c,r[o]),[r,c,o]);return e.createElement(C.x,{paddingBottom:4,paddingTop:6,style:{paddingLeft:me}},e.createElement(O.k,{gap:0},c.map(({label:m,actionId:u})=>e.createElement(En,{direction:"column",alignItems:"center",justifyContent:"center",key:u,gap:3},e.createElement(j.Z,{variant:"sigma",textColor:"neutral500"},s({id:`Settings.roles.form.permissions.${m.toLowerCase()}`,defaultMessage:m})),e.createElement(J.C,{disabled:n,onValueChange:p=>{l(o,u,p)},name:u,"aria-label":s({id:"Settings.permissions.select-all-by-permission",defaultMessage:"Select all {label} permissions"},{label:s({id:`Settings.roles.form.permissions.${m.toLowerCase()}`,defaultMessage:m})}),value:b()(d,[u,"hasAllActionsSelected"],!1),indeterminate:b()(d,[u,"hasSomeActionsSelected"],!1)})))))};Qe.defaultProps={actions:[]},Qe.propTypes={actions:i().arrayOf(i().shape({label:i().string.isRequired,actionId:i().string.isRequired,subjects:i().array.isRequired})),isFormDisabled:i().bool.isRequired,kind:i().string.isRequired};const vn=(0,e.memo)(Qe),Rn=(0,y.ZP)(C.x)`
  overflow-x: auto;
`,bt=({isFormDisabled:t,kind:n,layout:{actions:o,subjects:s}})=>{const r=xe()([...s],"label");return e.createElement(Rn,{background:"neutral0"},e.createElement(vn,{actions:o,kind:n,isFormDisabled:t}),e.createElement(fn,{actions:o,isFormDisabled:t,pathToData:n,subjects:r}))};bt.propTypes={isFormDisabled:i().bool.isRequired,kind:i().string.isRequired,layout:i().shape({actions:i().array,subjects:i().arrayOf(i().shape({uid:i().string.isRequired,label:i().string.isRequired,properties:i().array.isRequired}))}).isRequired};const Et=(0,e.memo)(bt);var xn=a(47713);const vt=({children:t,value:n})=>e.createElement(xn.$l.Provider,{value:n},t);vt.propTypes={children:i().node.isRequired,value:i().exact({availableConditions:i().array.isRequired,modifiedData:i().object.isRequired,onChangeCollectionTypeLeftActionRowCheckbox:i().func.isRequired,onChangeConditions:i().func.isRequired,onChangeSimpleCheckbox:i().func.isRequired,onChangeParentCheckbox:i().func.isRequired,onChangeCollectionTypeGlobalActionCheckbox:i().func.isRequired}).isRequired};const Sn=vt;var An=a(48734),Pn=a(74756),Tn=a(63081),Rt=a(36213),On=a(11276),Mn=a(67819);const $n=(t,n,o)=>t.map(s=>{const r=[...o,s.action,"properties","enabled"],l=b()(n,r,!1),c=b()(n,[...o,s.action,"conditions"],{}),d=Te(c).some(m=>m);return{...s,isDisplayed:l,checkboxName:r.join(".."),hasSomeActionsSelected:l,value:l,hasConditions:d,label:s.displayName,actionId:s.action,pathToConditionsObject:[...o,s.action]}}),kn=t=>{const n=Object.entries(t).reduce((s,r)=>{const[l,{conditions:c}]=r;return s[l]=c,s},{});return Te(n).some(s=>s)},Ln=y.ZP.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:t})=>t.colors.neutral150};
`,Dn=y.ZP.div`
  position: relative;
  word-break: keep-all;
  ${({hasConditions:t,disabled:n,theme:o})=>t&&`
    &:before {
      content: '';
      position: absolute;
      top: ${-4/16}rem;
      left: ${-8/16}rem;
      width: ${6/16}rem;
      height: ${6/16}rem;
      border-radius: ${20/16}rem;
      background: ${n?o.colors.neutral100:o.colors.primary600};
    }
  `}
`,xt=({categoryName:t,isFormDisabled:n,subCategoryName:o,actions:s,pathToData:r})=>{const[l,c]=(0,e.useState)(!1),{modifiedData:d,onChangeParentCheckbox:m,onChangeSimpleCheckbox:u}=(0,_.$_)(),{formatMessage:p}=(0,W.Z)(),f=b()(d,r,{}),E=(0,e.useMemo)(()=>Object.keys(f).reduce((P,X)=>(P[X]=ze(f[X]),P),{}),[f]),{hasAllActionsSelected:L,hasSomeActionsSelected:R}=be(E),h=()=>{c(P=>!P)},g=()=>{c(!1)},x=$n(s,d,r),v=kn(b()(d,[...r],{}));return e.createElement(e.Fragment,null,e.createElement(C.x,null,e.createElement(O.k,{justifyContent:"space-between",alignItems:"center"},e.createElement(C.x,{paddingRight:4},e.createElement(j.Z,{variant:"sigma",textColor:"neutral600"},o)),e.createElement(Ln,null),e.createElement(C.x,{paddingLeft:4},e.createElement(Rt.X,{name:r.join(".."),disabled:n,onValueChange:P=>{m({target:{name:r.join(".."),value:P}})},indeterminate:R,value:L},p({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(O.k,{paddingTop:6,paddingBottom:6},e.createElement(On.r,{gap:2,style:{flex:1}},x.map(({checkboxName:P,value:X,action:F,displayName:G,hasConditions:I})=>e.createElement(Mn.P,{col:3,key:F},e.createElement(Dn,{disabled:n,hasConditions:I},e.createElement(Rt.X,{name:P,disabled:n,onValueChange:re=>{u({target:{name:P,value:re}})},value:X},G))))),e.createElement(he,{hasConditions:v,onClick:h}))),l&&e.createElement(U,{headerBreadCrumbs:[t,o],actions:x,isFormDisabled:n,onClosed:g,onToggle:h}))};xt.propTypes={actions:i().array.isRequired,categoryName:i().string.isRequired,isFormDisabled:i().bool.isRequired,subCategoryName:i().string.isRequired,pathToData:i().array.isRequired};const jn=xt,_e=({childrenForm:t,kind:n,name:o,isOpen:s,isFormDisabled:r,isWhite:l,onOpenCategory:c,pathToData:d})=>{const{formatMessage:m}=(0,W.Z)(),u=()=>{c(o)},p=(0,e.useMemo)(()=>o.split("::").pop(),[o]);return e.createElement(An.U,{expanded:s,onToggle:u,id:`accordion-${o}`,variant:l?"primary":"secondary"},e.createElement(Pn.B,{title:le()(p),description:`${m({id:"Settings.permissions.category"},{category:p})} ${n==="plugins"?"plugin":n}`}),e.createElement(Tn.v,null,e.createElement(C.x,{padding:6},t.map(({actions:f,subCategoryName:E,subCategoryId:L})=>e.createElement(jn,{key:E,actions:f,categoryName:p,isFormDisabled:r,subCategoryName:E,pathToData:[...d,L]})))))};_e.defaultProps={},_e.propTypes={childrenForm:i().array.isRequired,isOpen:i().bool.isRequired,isFormDisabled:i().bool.isRequired,isWhite:i().bool.isRequired,kind:i().string.isRequired,name:i().string.isRequired,onOpenCategory:i().func.isRequired,pathToData:i().array.isRequired};const Zn=_e,St=({isFormDisabled:t,kind:n,layout:o})=>{const[s,r]=(0,e.useState)(null),l=c=>{r(c===s?null:c)};return e.createElement(C.x,{padding:6,background:"neutral0"},o.map(({category:c,categoryId:d,childrenForm:m},u)=>e.createElement(Zn,{key:c,childrenForm:m,kind:n,isFormDisabled:t,isOpen:s===c,isWhite:u%2===1,name:c,onOpenCategory:l,pathToData:[n,d]})))};St.propTypes={isFormDisabled:i().bool.isRequired,kind:i().string.isRequired,layout:i().arrayOf(i().shape({category:i().string.isRequired,categoryId:i().string.isRequired,childrenForm:i().arrayOf(i().shape({actions:i().array.isRequired})).isRequired}).isRequired).isRequired};const At=St;var In=a(82492),Fn=a.n(In),Bn=a(36968),oe=a.n(Bn);const Pt=(t,n,o)=>t.find(s=>s.action===n&&s.subject===o),Tt=(t,n=[])=>t.reduce((o,s)=>(o[s.id]=n.indexOf(s.id)!==-1,o),{}),Ot=({children:t},n,o="")=>t.reduce((s,r)=>{if(r.children)return{...s,[r.value]:Ot(r,n,`${o}${r.value}.`)};const l=n.indexOf(`${o}${r.value}`)!==-1;return s[r.value]=l,s},{}),Nn=(t,n,o)=>t.reduce((s,r)=>{const l=n.properties.find(({value:c})=>c===r);if(l){const c=b()(o,["properties",l.value],[]),d=Ot(l,c);s.properties[r]=d}return s},{properties:{}}),Vn=(t,n)=>n.reduce((o,s)=>{const r=t.find(({uid:l})=>l===s)||null;return r&&(o[s]=r),o},{}),Mt=({subjects:t},n,o,s=[])=>n.reduce((r,l)=>{const c=l.subjects,d=Vn(t,c);if(N()(d))return r;const m=Object.keys(d).reduce((u,p)=>{const{actionId:f,applyToProperties:E}=l,h=d[p].properties.map(({value:P})=>P).every(P=>(E||[]).indexOf(P)===-1),g=Pt(s,f,p),x=Tt(o,b()(g,"conditions",[]));if(N()(E)||h)return oe()(u,[p,f],{properties:{enabled:g!==void 0},conditions:x}),u;const v=Nn(E,d[p],g);return oe()(u,[p,f],{...v,conditions:x}),u},{});return Fn()(r,m)},{}),Hn=(t,n,o)=>t.reduce((s,r)=>{const l=Pt(o,r.action,null);return s[r.action]={properties:{enabled:l!==void 0},conditions:Tt(n,l?.conditions??[])},s},{}),Gn=(t,n,o)=>t.reduce((s,r)=>(s[r.subCategoryId]=Hn(r.actions,n,o),s),{}),$t=(t,n,o=[])=>t.reduce((s,{categoryId:r,childrenForm:l})=>{const c=Gn(l,n,o);return s[r]=c,s},{}),kt=t=>t.split(" ").join("-"),Lt=(t,n)=>Object.entries(H()(t,n)).map(([o,s])=>({category:o,categoryId:kt(o),childrenForm:Object.entries(H()(s,"subCategory")).map(([r,l])=>({subCategoryName:r,subCategoryId:kt(r),actions:l}))})),Wn=(t,n)=>{const{conditions:o,sections:{collectionTypes:s,singleTypes:r,plugins:l,settings:c}}=t,d={collectionTypes:s,singleTypes:r,plugins:Lt(l,"plugin"),settings:Lt(c,"category")},m={collectionTypes:Mt(s,s.actions||[],o,n),singleTypes:Mt(r,r.actions||[],o,n),plugins:$t(d.plugins,o,n),settings:$t(d.settings,o,n)};return{initialData:m,modifiedData:m,layouts:d}};var Kn=a(50361),et=a.n(Kn);const Dt=t=>Object.keys(t).reduce((n,o)=>{const s=t[o];if(pe()(s)&&!A()(s,"conditions"))return{...n,[o]:Dt(s)};if(pe()(s)&&A()(s,"conditions")&&!Te(Q()(s,"conditions")).some(l=>l)){const l=Object.keys(s.conditions).reduce((c,d)=>(c[d]=!1,c),{});return{...n,[o]:{...s,conditions:l}}}return n[o]=s,n},{}),tt=Dt,jt=(t,n,o=!1)=>Object.keys(t).reduce((s,r)=>{const l=t[r];return r==="conditions"&&!o?(s[r]=l,s):pe()(l)?{...s,[r]:jt(l,n,r==="fields")}:(s[r]=n,s)},{}),Ge=jt,Un={initialData:{},modifiedData:{},layouts:{}},zn=(t,n)=>(0,te.ZP)(t,o=>{switch(n.type){case"ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX":{const{collectionTypeKind:s,actionId:r,value:l}=n,c=["modifiedData",s];Object.keys(b()(t,c)).forEach(d=>{const m=b()(t,[...c,d,r],void 0);if(m){let u=Ge(m,l);if(!l&&u.conditions){const p=Ge(u.conditions,!1);u={...u,conditions:p}}oe()(o,[...c,d,r],u)}});break}case"ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX":{const{pathToCollectionType:s,propertyName:r,rowName:l,value:c}=n;let d=et()(t.modifiedData);const m=s.split(".."),u=b()(d,m,{});Object.keys(u).forEach(p=>{if(A()(u[p],`properties.${r}`)){const f=b()(u,[p,"properties",r,l]),E=[...m,p,"properties",r,l];if(!pe()(f))oe()(d,E,c);else{const L=Ge(f,c);oe()(d,E,L)}}}),c||(d=tt(d)),oe()(o,"modifiedData",d);break}case"ON_CHANGE_CONDITIONS":{Object.entries(n.conditions).forEach(s=>{const[r,l]=s;oe()(o,["modifiedData",...r.split(".."),"conditions"],l)});break}case"ON_CHANGE_SIMPLE_CHECKBOX":{let s=et()(t.modifiedData);oe()(s,[...n.keys.split("..")],n.value),n.value||(s=tt(s)),oe()(o,"modifiedData",s);break}case"ON_CHANGE_TOGGLE_PARENT_CHECKBOX":{const{keys:s,value:r}=n,l=[...s.split("..")];let c=et()(t.modifiedData);const d=b()(c,l,{}),m=Ge(d,r);oe()(c,l,m),r||(c=tt(c)),oe()(o,["modifiedData"],c);break}case"RESET_FORM":{o.modifiedData=t.initialData;break}case"SET_FORM_AFTER_SUBMIT":{o.initialData=t.modifiedData;break}default:return o}}),nt=t=>Object.entries(t).filter(([,n])=>n).map(([n])=>n),Xn=t=>{const[n,{conditions:o}]=t;return{action:n,subject:null,conditions:nt(o),properties:{}}},Yn=t=>Object.values(t).reduce((n,o)=>{const s=Object.entries(o).reduce((r,l)=>{const[,{properties:{enabled:c}}]=l;if(!c)return r;const d=Xn(l);return r.push(d),r},[]);return[...n,...s]},[]),Zt=t=>Object.values(t).reduce((n,o)=>{const s=Yn(o);return[...n,...s]},[]),It=(t,n="")=>Object.entries(t).reduce((o,s)=>{const[r,l]=s;return pe()(l)?[...o,...It(l,`${n}${r}.`)]:(l&&!pe()(l)&&o.push(`${n}${r}`),o)},[]),wn=(t,n,{conditions:o,properties:s})=>Object.entries(s).reduce((r,l)=>{const[c,d]=l;return r.properties[c]=It(d),r},{action:t,subject:n,conditions:nt(o),properties:{}}),qn=(t,n,{conditions:o})=>({action:t,subject:n,properties:{},conditions:nt(o)}),Jn=(t,n)=>Object.entries(n).reduce((s,r)=>{const[l,c]=r;if(!Te(c).some(u=>u))return s;if(!c?.properties?.enabled){const u=wn(l,t,c);return[...s,u]}if(!c.properties.enabled)return s;const m=qn(l,t,c);return s.push(m),s},[]),Ft=t=>Object.entries(t).reduce((o,s)=>{const[r,l]=s,c=Jn(r,l);return[...o,...c]},[]),Qn=t=>{const n=Zt(t.plugins),o=Zt(t.settings),s=Ft(t.collectionTypes),r=Ft(t.singleTypes);return[...n,...o,...s,...r]},_n=[{labelId:"app.components.LeftMenuLinkContainer.collectionTypes",defaultMessage:"Collection Types",id:"collectionTypes"},{labelId:"app.components.LeftMenuLinkContainer.singleTypes",id:"singleTypes",defaultMessage:"Single Types"},{labelId:"app.components.LeftMenuLinkContainer.plugins",defaultMessage:"Plugins",id:"plugins"},{labelId:"app.components.LeftMenuLinkContainer.settings",defaultMessage:"Settings",id:"settings"}],st=(0,e.forwardRef)(({layout:t,isFormDisabled:n,permissions:o},s)=>{const[{initialData:r,layouts:l,modifiedData:c},d]=(0,e.useReducer)(zn,Un,()=>Wn(t,o)),{formatMessage:m}=(0,W.Z)();(0,e.useImperativeHandle)(s,()=>({getPermissions(){const R=(0,B.e5)(r.collectionTypes,c.collectionTypes),h=(0,B.e5)(r.singleTypes,c.singleTypes),g={...R,...h};let x;return N()(g)?x=!1:x=Object.values(g).some(v=>Object.values(v).some(P=>A()(P,"conditions"))),{permissionsToSend:Qn(c),didUpdateConditions:x}},resetForm(){d({type:"RESET_FORM"})},setFormAfterSubmit(){d({type:"SET_FORM_AFTER_SUBMIT"})}}));const u=(R,h,g,x)=>{d({type:"ON_CHANGE_COLLECTION_TYPE_ROW_LEFT_CHECKBOX",pathToCollectionType:R,propertyName:h,rowName:g,value:x})},p=(R,h,g)=>{d({type:"ON_CHANGE_COLLECTION_TYPE_GLOBAL_ACTION_CHECKBOX",collectionTypeKind:R,actionId:h,value:g})},f=R=>{d({type:"ON_CHANGE_CONDITIONS",conditions:R})},E=(0,e.useCallback)(({target:{name:R,value:h}})=>{d({type:"ON_CHANGE_SIMPLE_CHECKBOX",keys:R,value:h})},[]),L=(0,e.useCallback)(({target:{name:R,value:h}})=>{d({type:"ON_CHANGE_TOGGLE_PARENT_CHECKBOX",keys:R,value:h})},[]);return e.createElement(Sn,{value:{availableConditions:t.conditions,modifiedData:c,onChangeConditions:f,onChangeSimpleCheckbox:E,onChangeParentCheckbox:L,onChangeCollectionTypeLeftActionRowCheckbox:u,onChangeCollectionTypeGlobalActionCheckbox:p}},e.createElement(T.v,{id:"tabs",label:m({id:"Settings.permissions.users.tabs.label",defaultMessage:"Tabs Permissions"})},e.createElement(k.m,null,_n.map(R=>e.createElement(k.O,{key:R.id},m({id:R.labelId,defaultMessage:R.defaultMessage})))),e.createElement(S.n,{style:{position:"relative"}},e.createElement(S.x,null,e.createElement(Et,{layout:l.collectionTypes,kind:"collectionTypes",isFormDisabled:n})),e.createElement(S.x,null,e.createElement(Et,{layout:l.singleTypes,kind:"singleTypes",isFormDisabled:n})),e.createElement(S.x,null,e.createElement(At,{layout:l.plugins,kind:"plugins",isFormDisabled:n})),e.createElement(S.x,null,e.createElement(At,{layout:l.settings,kind:"settings",isFormDisabled:n})))))});st.defaultProps={permissions:[],layout:{conditions:[],sections:{collectionTypes:{},singleTypes:{actions:[]},settings:[],plugins:[]}}},st.propTypes={layout:i().object,isFormDisabled:i().bool.isRequired,permissions:i().array};const es=(0,e.memo)(st)},92100:(w,z,a)=>{"use strict";a.r(z),a.d(z,{default:()=>V});var e=a(67294),T=a(60698),k=a(16550),S=a(87751),B=a(185),D=a(53979),A=a(11047),$=a(29728),N=a(49066),q=a(41580),i=a(67109),W=a(14916),C=a(27361),Re=a.n(C),xe=a(86896),y=a(51319),O=a(18280),J=a(75515),Me=a(11276),Se=a(67819),$e=a(16364),b=a(61467),ke=a(45697),Q=a.n(ke);const _=({disabled:j,role:K,values:M,errors:ee,onChange:te,onBlur:ie})=>{const{formatMessage:H}=(0,xe.Z)();return e.createElement(q.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(A.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(A.k,{justifyContent:"space-between"},e.createElement(q.x,null,e.createElement(q.x,null,e.createElement(J.Z,{fontWeight:"bold"},K?K.name:H({id:"global.details",defaultMessage:"Details"}))),e.createElement(q.x,null,e.createElement(J.Z,{textColor:"neutral500",variant:"pi"},K?K.description:H({id:"Settings.roles.form.description",defaultMessage:"Name and description of the role"})))),e.createElement($.z,{disabled:!0,variant:"secondary"},H({id:"Settings.roles.form.button.users-with-role",defaultMessage:"{number, plural, =0 {# users} one {# user} other {# users}} with this role"},{number:K.usersCount}))),e.createElement(Me.r,{gap:4},e.createElement(Se.P,{col:6},e.createElement($e.o,{disabled:j,name:"name",error:ee.name&&H({id:ee.name}),label:H({id:"global.name",defaultMessage:"Name"}),onChange:te,onBlur:ie,value:M.name||""})),e.createElement(Se.P,{col:6},e.createElement(b.g,{disabled:j,label:H({id:"global.description",defaultMessage:"Description"}),id:"description",error:ee.name&&H({id:ee.name}),onChange:te,onBlur:ie},M.description||"")))))};_.defaultProps={disabled:!1,role:null,values:{name:"",description:""}},_.propTypes={disabled:Q().bool,errors:Q().object.isRequired,onBlur:Q().func.isRequired,onChange:Q().func.isRequired,role:Q().object,values:Q().object};const ge=_;var de=a(87561);const fe=de.Ry().shape({name:de.Z_().required(T.I0.required)}),Ae=()=>{const j=(0,T.lm)(),{formatMessage:K}=(0,xe.Z)(),{params:{id:M}}=(0,k.$B)("/settings/roles/:id"),[ee,te]=(0,e.useState)(!1),ie=(0,e.useRef)(),{lockApp:H,unlockApp:ue}=(0,T.o1)(),{trackUsage:le}=(0,T.rS)(),{isLoading:ye,data:Le}=(0,y.U_)(M),{role:ae,permissions:De,isLoading:Ce,onSubmitSucceeded:je}=(0,y.Dq)(M),{put:Pe}=(0,T.kY)(),Ze=async ne=>{try{H(),te(!0);const{permissionsToSend:Z,didUpdateConditions:U}=ie.current.getPermissions();await Pe(`/admin/roles/${M}`,ne),ae.code!=="strapi-super-admin"&&(await Pe(`/admin/roles/${M}/permissions`,{permissions:Z}),U&&le("didUpdateConditions")),ie.current.setFormAfterSubmit(),je({name:ne.name,description:ne.description}),j({type:"success",message:{id:"notification.success.saved"}})}catch(Z){console.error(Z.response);const U=Re()(Z,"response.payload.message","An error occured"),se=Re()(Z,"response.payload.data.permissions[0]",U);j({type:"warning",message:se})}finally{te(!1),ue()}},Ie=ae.code==="strapi-super-admin";return e.createElement(B.o,null,e.createElement(T.SL,{name:"Roles"}),e.createElement(W.J9,{enableReinitialize:!0,initialValues:{name:ae.name,description:ae.description},onSubmit:Ze,validationSchema:fe,validateOnChange:!1},({handleSubmit:ne,values:Z,errors:U,handleChange:se,handleBlur:me})=>e.createElement("form",{onSubmit:ne},e.createElement(D.T,{primaryAction:e.createElement(A.k,{gap:2},e.createElement($.z,{disabled:ae.code==="strapi-super-admin",onClick:ne,loading:ee,size:"L"},K({id:"global.save",defaultMessage:"Save"}))),title:K({id:"Settings.roles.edit.title",defaultMessage:"Edit a role"}),subtitle:K({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"}),navigationAction:e.createElement(T.rU,{startIcon:e.createElement(i.Z,null),to:"/settings/roles"},K({id:"global.back",defaultMessage:"Back"}))}),e.createElement(N.D,null,e.createElement(A.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(ge,{isLoading:Ce,disabled:Ie,errors:U,values:Z,onChange:se,onBlur:me,role:ae}),!ye&&!Ce?e.createElement(q.x,{shadow:"filterShadow",hasRadius:!0},e.createElement(O.Z,{isFormDisabled:Ie,permissions:De,ref:ie,layout:Le})):e.createElement(q.x,{background:"neutral0",padding:6,shadow:"filterShadow",hasRadius:!0},e.createElement(T.dO,null)))))))},V=()=>{const j=(0,e.useMemo)(()=>({read:S.Z.settings.roles.read,update:S.Z.settings.roles.update}),[]),{isLoading:K,allowedActions:{canRead:M,canUpdate:ee}}=(0,T.ss)(j);return K?e.createElement(T.dO,null):!M&&!ee?e.createElement(k.l_,{to:"/"}):e.createElement(Ae,null)}},44174:w=>{function z(a,e,T,k){for(var S=-1,B=a==null?0:a.length;++S<B;){var D=a[S];e(k,D,T(D),a)}return k}w.exports=z},81119:(w,z,a)=>{var e=a(89881);function T(k,S,B,D){return e(k,function(A,$,N){S(D,A,B(A),N)}),D}w.exports=T},55189:(w,z,a)=>{var e=a(44174),T=a(81119),k=a(67206),S=a(1469);function B(D,A){return function($,N){var q=S($)?e:T,i=A?A():{};return q($,D,k(N,2),i)}}w.exports=B},42348:(w,z,a)=>{var e=a(21078),T=1/0;function k(S){var B=S==null?0:S.length;return B?e(S,T):[]}w.exports=k},7739:(w,z,a)=>{var e=a(89465),T=a(55189),k=Object.prototype,S=k.hasOwnProperty,B=T(function(D,A,$){S.call(D,$)?D[$].push(A):e(D,$,[A])});w.exports=B},38953:(w,z,a)=>{"use strict";a.d(z,{Q:()=>S});var e=a(85893),T=a(71997),k=a(67730);const S=({options:D,...A})=>(0,e.jsx)(k.NU,{...A,children:D.map($=>"children"in $?(0,e.jsx)(k.Ab,{label:$.label,values:$.children.map(N=>N.value.toString()),children:$.children.map(N=>(0,e.jsx)(B,{value:N.value,children:N.label},N.value))},$.label):(0,e.jsx)(k.ML,{value:$.value,children:$.label},$.value))}),B=(0,T.ZP)(k.ML)`
  padding-left: ${({theme:D})=>D.spaces[7]};
`}}]);
