"use strict";(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[2812],{50935:(U,p,t)=>{t.d(p,{R:()=>y});var e=t(60698),s=t(80129),E=t(88767);function y(L={},T={}){const{id:c="",...P}=L,D=(0,s.stringify)(P,{encode:!1}),{get:v}=(0,e.kY)(),{data:f,isError:C,isLoading:R,refetch:b}=(0,E.useQuery)(["users",c,P],async()=>{const{data:{data:O}}=await v(`/admin/users/${c}${D?`?${D}`:""}`);return O},T);let A=[];return c&&f?A=[f]:Array.isArray(f?.results)&&(A=f.results),{users:A,pagination:f?.pagination??null,isLoading:R,isError:C,refetch:b}}},94699:(U,p,t)=>{t.d(p,{Z:()=>v});var e=t(67294),s=t(41580),E=t(29728),y=t(60698),L=t(89597),T=t(45697),c=t.n(T),P=t(86896);const D=({displayedFilters:f})=>{const[C,R]=(0,e.useState)(!1),{formatMessage:b}=(0,P.Z)(),A=(0,e.useRef)(),O=()=>{R(Z=>!Z)};return e.createElement(e.Fragment,null,e.createElement(s.x,{paddingTop:1,paddingBottom:1},e.createElement(E.z,{variant:"tertiary",ref:A,startIcon:e.createElement(L.Z,null),onClick:O,size:"S"},b({id:"app.utils.filters",defaultMessage:"Filters"})),C&&e.createElement(y.J5,{displayedFilters:f,isVisible:C,onToggle:O,source:A})),e.createElement(y.W$,{filtersSchema:f}))};D.propTypes={displayedFilters:c().arrayOf(c().shape({name:c().string.isRequired,metadatas:c().shape({label:c().string}),fieldSchema:c().shape({type:c().string})})).isRequired};const v=D},35915:(U,p,t)=>{t.r(p),t.d(p,{default:()=>Le});var e=t(67294),s=t(60698),E=t(87751),y=t(17034),L=t(49066),T=t(41580),c=t(185),P=t(53979),D=t(36989),v=t(86896),f=t(94699),C=t(88767),R=t(16550),b=t(50935);const O=({canReadAuditLogs:a,canReadUsers:d})=>{const{get:u}=(0,s.kY)(),{search:r}=(0,R.TH)(),m=(0,s.lm)(),o={keepPreviousData:!0,retry:!1,staleTime:1e3*20,onError:M=>m({type:"warning",message:M.message})},{users:l,isError:i,isLoading:g}=(0,b.R)({},{...o,enabled:d,staleTime:2*(1e3*60)}),{data:h,isLoading:S,isError:x}=(0,C.useQuery)(["auditLogs",r],async({queryKey:M})=>{const ve=M[1],{data:Me}=await u(`/admin/audit-logs${ve}`);return Me},{...o,enabled:a});return{auditLogs:h,users:l,isLoading:g||S,hasError:x||i}};var Z=t(42866),G=t(24969),w=t(59946),k=t(63321),q=t(36773),_=t(45697),n=t.n(_),ee=t(23855);const N=()=>{const{formatDate:a}=(0,v.Z)();return u=>{const r=(0,ee.Z)(u),m=a(r,{dateStyle:"long"}),o=a(r,{timeStyle:"medium",hourCycle:"h24"});return`${m}, ${o}`}};var I=t(11047),te=t(77197),B=t(75515),ae=t(11276),se=t(39990);const H={"entry.create":"Create entry{model, select, undefined {} other { ({model})}}","entry.update":"Update entry{model, select, undefined {} other { ({model})}}","entry.delete":"Delete entry{model, select, undefined {} other { ({model})}}","entry.publish":"Publish entry{model, select, undefined {} other { ({model})}}","entry.unpublish":"Unpublish entry{model, select, undefined {} other { ({model})}}","media.create":"Create media","media.update":"Update media","media.delete":"Delete media","media-folder.create":"Create media folder","media-folder.update":"Update media folder","media-folder.delete":"Delete media folder","user.create":"Create user","user.update":"Update user","user.delete":"Delete user","admin.auth.success":"Admin login","admin.logout":"Admin logout","content-type.create":"Create content type","content-type.update":"Update content type","content-type.delete":"Delete content type","component.create":"Create component","component.update":"Update component","component.delete":"Delete component","role.create":"Create role","role.update":"Update role","role.delete":"Delete role","permission.create":"Create permission","permission.update":"Update permission","permission.delete":"Delete permission"},$=a=>H[a]||a,Q=({actionLabel:a,actionName:d})=>e.createElement(I.k,{direction:"column",alignItems:"baseline",gap:1},e.createElement(B.Z,{textColor:"neutral600",variant:"sigma"},a),e.createElement(B.Z,{textColor:"neutral600"},d));Q.propTypes={actionLabel:n().string.isRequired,actionName:n().string.isRequired};const F=Q,W=({status:a,data:d,formattedDate:u})=>{const{formatMessage:r}=(0,v.Z)();if(a==="loading")return e.createElement(I.k,{padding:7,justifyContent:"center",alignItems:"center"},e.createElement(te.a,null,"Loading content..."));const{action:m,user:o,payload:l}=d;return e.createElement(e.Fragment,null,e.createElement(T.x,{marginBottom:3},e.createElement(B.Z,{variant:"delta",id:"title"},r({id:"Settings.permissions.auditLogs.details",defaultMessage:"Log Details"}))),e.createElement(ae.r,{gap:4,gridCols:2,paddingTop:4,paddingBottom:4,paddingLeft:6,paddingRight:6,marginBottom:4,background:"neutral100",hasRadius:!0},e.createElement(F,{actionLabel:r({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),actionName:r({id:`Settings.permissions.auditLogs.${m}`,defaultMessage:$(m)},{model:l?.model})}),e.createElement(F,{actionLabel:r({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"}),actionName:u}),e.createElement(F,{actionLabel:r({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),actionName:o?.displayName||"-"}),e.createElement(F,{actionLabel:r({id:"Settings.permissions.auditLogs.userId",defaultMessage:"User ID"}),actionName:o?.id.toString()||"-"})),e.createElement(se.V,{value:JSON.stringify(l,null,2),disabled:!0,label:r({id:"Settings.permissions.auditLogs.payload",defaultMessage:"Payload"})}))};W.defaultProps={data:{}},W.propTypes={status:n().oneOf(["idle","loading","error","success"]).isRequired,data:n().shape({action:n().string,date:n().string,payload:n().object,user:n().object}),formattedDate:n().string.isRequired};const ne=W,Y=({handleClose:a,logId:d})=>{const{get:u}=(0,s.kY)(),r=(0,s.lm)(),m=async h=>{const{data:S}=await u(`/admin/audit-logs/${h}`);if(!S)throw new Error("Audit log not found");return S},{data:o,status:l}=(0,C.useQuery)(["audit-log",d],()=>m(d),{onError(){r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}}),a()}}),i=N(),g=o?i(o.date):"";return e.createElement(Z.P,{onClose:a,labelledBy:"title"},e.createElement(G.x,null,e.createElement(k.O,{label:g,id:"title"},e.createElement(q.$,{isCurrent:!0},g))),e.createElement(w.f,null,e.createElement(ne,{status:l,data:o,formattedDate:g})))};Y.propTypes={handleClose:n().func.isRequired,logId:n().string.isRequired};const oe=Y,j=({pagination:a})=>e.createElement(T.x,{paddingTop:4},e.createElement(I.k,{alignItems:"flex-end",justifyContent:"space-between"},e.createElement(s.v4,null),e.createElement(s.tU,{pagination:a})));j.defaultProps={pagination:{pageCount:0,pageSize:50,total:0}},j.propTypes={pagination:n().shape({page:n().number,pageCount:n().number,pageSize:n().number,total:n().number})};const ie=j;var re=t(15234),le=t(79031),z=t(37909),de=t(12028),me=t(8934);const K=({headers:a,rows:d,onOpenModal:u})=>{const{formatMessage:r}=(0,v.Z)(),m=N(),o=({type:l,value:i,model:g})=>l==="date"?m(i):l==="action"?r({id:`Settings.permissions.auditLogs.${i}`,defaultMessage:$(i)},{model:g}):i||"-";return e.createElement(re.p,null,d.map(l=>e.createElement(le.Tr,{key:l.id,...(0,s.X7)({fn:()=>u(l.id)})},a.map(({key:i,name:g,cellFormatter:h})=>e.createElement(z.Td,{key:i},e.createElement(B.Z,{textColor:"neutral800"},o({type:i,value:h?h(l[g]):l[g],model:l.payload?.model})))),e.createElement(z.Td,{...s.UW},e.createElement(I.k,{justifyContent:"end"},e.createElement(de.h,{onClick:()=>u(l.id),"aria-label":r({id:"app.component.table.view",defaultMessage:"{target} details"},{target:`${l.action} action`}),noBorder:!0,icon:e.createElement(me.Z,null)}))))))};K.defaultProps={rows:[]},K.propTypes={headers:n().array.isRequired,rows:n().array,onOpenModal:n().func.isRequired};const ue=K;var ce=t(29178),ge=t(90608);const V=({value:a,options:d,onChange:u})=>{const{formatMessage:r}=(0,v.Z)(),m=r({id:"Settings.permissions.auditLogs.filter.aria-label",defaultMessage:"Search and select an option to filter"});return e.createElement(ce.hQ,{"aria-label":m,value:a,onChange:u},d.map(({label:o,customValue:l})=>e.createElement(ge.O,{key:l,value:l},o)))};V.defaultProps={value:null},V.propTypes={value:n().string,options:n().arrayOf(n().shape({label:n().string.isRequired,customValue:n().string.isRequired}).isRequired).isRequired,onChange:n().func.isRequired};const J=V,X=[{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$eq",defaultMessage:"is"},value:"$eq"},{intlLabel:{id:"components.FilterOptions.FILTER_TYPES.$ne",defaultMessage:"is not"},value:"$ne"}],pe=({formatMessage:a,users:d,canReadUsers:u})=>{const r=Object.keys(H).map(o=>({label:a({id:`Settings.permissions.auditLogs.${o}`,defaultMessage:$(o)},{model:void 0}),customValue:o})),m=[{name:"action",metadatas:{customOperators:X,label:a({id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"}),options:r,customInput:J},fieldSchema:{type:"enumeration"}},{name:"date",metadatas:{label:a({id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"})},fieldSchema:{type:"datetime"}}];if(u&&d){const o=i=>i.username?i.username:i.firstname&&i.lastname?a({id:"Settings.permissions.auditLogs.user.fullname",defaultMessage:"{firstname} {lastname}"},{firstname:i.firstname,lastname:i.lastname}):i.email,l=d.map(i=>({label:o(i),customValue:i.id.toString()}));return[...m,{name:"user",metadatas:{customOperators:X,label:a({id:"Settings.permissions.auditLogs.user",defaultMessage:"User"}),options:l,customInput:J},fieldSchema:{type:"relation",mainField:{name:"id"}}}]}return m},fe=[{name:"action",key:"action",metadatas:{label:{id:"Settings.permissions.auditLogs.action",defaultMessage:"Action"},sortable:!0}},{name:"date",key:"date",metadatas:{label:{id:"Settings.permissions.auditLogs.date",defaultMessage:"Date"},sortable:!0}},{key:"user",name:"user",metadatas:{label:{id:"Settings.permissions.auditLogs.user",defaultMessage:"User"},sortable:!1},cellFormatter:a=>a?a.displayName:""}],Ee={...E.Z.settings.auditLogs,readUsers:E.Z.settings.users.read},ye=()=>{const{formatMessage:a}=(0,v.Z)(),{allowedActions:{canRead:d,canReadUsers:u}}=(0,s.ss)(Ee),[{query:r},m]=(0,s.Kx)(),{auditLogs:o,users:l,isLoading:i,hasError:g}=O({canReadAuditLogs:d,canReadUsers:u});(0,s.go)();const h=pe({formatMessage:a,users:l,canReadUsers:u}),S=a({id:"global.auditLogs",defaultMessage:"Audit Logs"}),x=fe.map(M=>({...M,metadatas:{...M.metadatas,label:a(M.metadatas.label)}}));return g?e.createElement(y.A,null,e.createElement(L.D,null,e.createElement(T.x,{paddingTop:8},e.createElement(s.Hn,null)))):e.createElement(c.o,{"aria-busy":i},e.createElement(s.SL,{name:S}),e.createElement(P.T,{title:S,subtitle:a({id:"Settings.permissions.auditLogs.listview.header.subtitle",defaultMessage:"Logs of all the activities that happened in your environment"})}),e.createElement(D.Z,{startActions:e.createElement(f.Z,{displayedFilters:h})}),e.createElement(L.D,{canRead:d},e.createElement(s.tM,{contentType:"Audit logs",headers:x,rows:o?.results||[],withBulkActions:!0,isLoading:i},e.createElement(ue,{headers:x,rows:o?.results||[],onOpenModal:M=>m({id:M})})),e.createElement(ie,{pagination:o?.pagination})),r?.id&&e.createElement(oe,{handleClose:()=>m({id:null},"remove"),logId:r.id}))},Le=()=>e.createElement(s.O4,{permissions:E.Z.settings.auditLogs.main},e.createElement(ye,null))},90608:(U,p,t)=>{t.d(p,{O:()=>s});var e=t(29178);const s=e.Wx},36989:(U,p,t)=>{t.d(p,{Z:()=>E});var e=t(85893),s=t(11047);const E=({startActions:y,endActions:L})=>!y&&!L?null:(0,e.jsxs)(s.k,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(s.k,{gap:2,wrap:"wrap",children:y}),(0,e.jsx)(s.k,{gap:2,shrink:0,wrap:"wrap",children:L})]})}}]);
