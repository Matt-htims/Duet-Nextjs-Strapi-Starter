"use strict";(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[5162],{93016:($,h,t)=>{t.d(h,{Z:()=>v});var e=t(67294),m=t(84714);function c(){return e.createElement(m.Z.Root,null,e.createElement(m.Z.Headers,null),e.createElement(m.Z.Body,null))}const v=c},84714:($,h,t)=>{t.d(h,{Z:()=>Ee});var e=t(67294),m=t(45421),c=t(11047),v=t(19270),N=t(77197),H=t(65833),Y=t(33709),W=t(54580),p=t(63237),J=t(75515),ce=t(26031),X=t(36213),_=t(92155),R=t(14916),q=t(45697),P=t.n(q),z=t(86896),ue=t(71997),A=t(39645);const ge=o=>o.reduce((i,l)=>{const C=l.split(".")[0];return i[C]||(i[C]=[]),i[C].push(l),i},{}),E=(0,ue.ZP)(m.w)`
  tbody tr:nth-child(odd) {
    background: ${({theme:o})=>o.colors.neutral100};
  }

  thead th span {
    color: ${({theme:o})=>o.colors.neutral500};
  }

  td,
  th {
    padding-block-start: ${({theme:o})=>o.spaces[3]};
    padding-block-end: ${({theme:o})=>o.spaces[3]};
    width: 10%;
    vertical-align: middle;
    text-align: center;
  }

  tbody tr td:first-child {
    // Add padding to the start of the first column to avoid the checkbox appearing
    // too close to the edge of the table
    padding-inline-start: ${({theme:o})=>o.spaces[2]};
  }
`,I=o=>{const i=[{id:"Settings.webhooks.events.create",defaultMessage:"Create"},{id:"Settings.webhooks.events.update",defaultMessage:"Update"},{id:"app.utils.delete",defaultMessage:"Delete"}];return o&&(i.push({id:"app.utils.publish",defaultMessage:"Publish"}),i.push({id:"app.utils.unpublish",defaultMessage:"Unpublish"})),i},me=o=>{const i=["entry.create","entry.update","entry.delete"];return o&&i.push("entry.publish","entry.unpublish"),{entry:i,media:["media.create","media.update","media.delete"]}},ee=e.createContext(),oe=({children:o})=>{const{formatMessage:i}=(0,z.Z)(),{collectionTypes:l,isLoading:C}=(0,A.G)(),M=e.useMemo(()=>l.some(O=>O.options.draftAndPublish===!0),[l]),k=i({id:"Settings.webhooks.form.events",defaultMessage:"Events"});return e.createElement(ee.Provider,{value:{isDraftAndPublish:M}},e.createElement(c.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(v.Q,{"aria-hidden":!0},k),C&&e.createElement(N.a,null,i({id:"Settings.webhooks.events.isLoading",defaultMessage:"Events loading"})),e.createElement(E,{"aria-label":k},o)))};oe.propTypes={children:P().oneOfType([P().arrayOf(P().node),P().node]).isRequired};const te=({getHeaders:o=I})=>{const{isDraftAndPublish:i}=e.useContext(ee),{formatMessage:l}=(0,z.Z)(),C=o(i);return e.createElement(H.S,null,e.createElement(Y.Z,null,e.createElement(W.g,null,e.createElement(p.T,null,l({id:"Settings.webhooks.event.select",defaultMessage:"Select event"}))),C.map(M=>["app.utils.publish","app.utils.unpublish"].includes(M.id)?e.createElement(W.g,{key:M.id,title:l({id:"Settings.webhooks.event.publish-tooltip",defaultMessage:"This event only exists for content with draft & publish enabled"})},e.createElement(J.Z,{variant:"sigma",textColor:"neutral600"},l(M))):e.createElement(W.g,{key:M.id},e.createElement(J.Z,{variant:"sigma",textColor:"neutral600"},l(M))))))};te.defaultProps={getHeaders:I},te.propTypes={getHeaders:P().func};const ne=({providedEvents:o})=>{const{isDraftAndPublish:i}=e.useContext(ee),l=o||me(i),{values:C,handleChange:M}=(0,R.u6)(),k="events",O=C.events,U=[],V=ge(O),x=({target:{name:b,value:d}})=>{let S=new Set(O);d?S.add(b):S.delete(b),M({target:{name:k,value:Array.from(S)}})},j=({target:{name:b,value:d}})=>{let S=new Set(O);d?l[b].forEach(G=>{U.includes(G)||S.add(G)}):l[b].forEach(G=>S.delete(G)),M({target:{name:k,value:Array.from(S)}})};return e.createElement(ce.X,null,Object.entries(l).map(([b,d])=>e.createElement(B,{disabledEvents:U,key:b,name:b,events:d,inputValue:V[b],handleSelect:x,handleSelectAll:j})))};ne.defaultProps={providedEvents:null},ne.propTypes={providedEvents:P().object};const le=o=>o.replace(/-/g," ").split(" ").map(i=>i.charAt(0).toUpperCase()+i.slice(1).toLowerCase()).join(" "),B=({disabledEvents:o,name:i,events:l,inputValue:C,handleSelect:M,handleSelectAll:k})=>{const{formatMessage:O}=(0,z.Z)(),U=l.filter(d=>!o.includes(d)),V=C.length>0,x=C.length===U.length,j=({target:{name:d}})=>{k({target:{name:d,value:!x}})},b=5;return e.createElement(Y.Z,null,e.createElement(W.f,null,e.createElement(X.X,{indeterminate:V&&!x,"aria-label":O({id:"global.select-all-entries",defaultMessage:"Select all entries"}),name:i,onChange:j,value:x},le(i))),l.map(d=>e.createElement(W.f,{key:d},e.createElement(_.C,{disabled:o.includes(d),"aria-label":d,name:d,value:C.includes(d),onValueChange:S=>M({target:{name:d,value:S}})}))),l.length<b&&e.createElement(W.f,{colSpan:`${b-l.length}`}))};B.defaultProps={disabledEvents:[],events:[],inputValue:[],handleSelect(){},handleSelectAll(){}},B.propTypes={disabledEvents:P().array,events:P().array,inputValue:P().array,handleSelect:P().func,handleSelectAll:P().func,name:P().string.isRequired};const Ee={Root:oe,Headers:te,Body:ne,EventRow:B}},41128:($,h,t)=>{t.d(h,{Z:()=>Pe});var e=t(67294),m=t(185),c=t(60698),v=t(88767),N=t(16550),H=t(39645),Y=t(70885),W=t(53979),p=t(11047),J=t(29728),ce=t(49066),X=t(41580),_=t(11276),R=t(67819),q=t(16364),P=t(90321),z=t(85018),ue=t(67109),A=t(14916),ge=t(45697),E=t.n(ge),I=t(86896),me=t(19270),ee=t(39785),oe=t(96315),te=t(29178),ne=t(90608);const le=["A-IM","Accept","Accept-Charset","Accept-Encoding","Accept-Language","Accept-Datetime","Access-Control-Request-Method","Access-Control-Request-Headers","Authorization","Cache-Control","Connection","Content-Length","Content-Type","Cookie","Date","Expect","Forwarded","From","Host","If-Match","If-Modified-Since","If-None-Match","If-Range","If-Unmodified-Since","Max-Forwards","Origin","Pragma","Proxy-Authorization","Range","Referer","TE","User-Agent","Upgrade","Via","Warning"],B=({name:n,onChange:a,value:s,...u})=>{const{values:{headers:f}}=(0,A.u6)(),[L,g]=(0,e.useState)(le);(0,e.useEffect)(()=>{g(le.filter(r=>!f?.some(w=>w.key!==s&&w.key===r)))},[f,s]);const K=r=>{a({target:{name:n,value:r}})},ae=r=>{g(w=>[...w,r]),K(r)};return e.createElement(te.XU,{...u,onClear:()=>K(""),onChange:K,onCreateOption:ae,placeholder:"",value:s},L.map(r=>e.createElement(ne.O,{value:r,key:r},r)))};B.defaultProps={value:void 0},B.propTypes={name:E().string.isRequired,onChange:E().func.isRequired,value:E().string};const Ee=B,i=()=>{const{formatMessage:n}=(0,I.Z)(),{values:a,errors:s}=(0,A.u6)();return e.createElement(p.k,{direction:"column",alignItems:"stretch",gap:1},e.createElement(me.Q,null,n({id:"Settings.webhooks.form.headers",defaultMessage:"Headers"})),e.createElement(X.x,{padding:8,background:"neutral100",hasRadius:!0},e.createElement(A.F2,{validateOnChange:!1,name:"headers",render:({push:u,remove:f})=>e.createElement(_.r,{gap:4},a.headers.map((L,g)=>e.createElement(e.Fragment,{key:`${g}.${L.key}`},e.createElement(R.P,{col:6},e.createElement(A.gN,{as:Ee,name:`headers.${g}.key`,"aria-label":`row ${g+1} key`,label:n({id:"Settings.webhooks.key",defaultMessage:"Key"}),error:s.headers?.[g]?.key&&s.headers[g].key})),e.createElement(R.P,{col:6},e.createElement(p.k,{alignItems:"flex-end"},e.createElement(X.x,{style:{flex:1}},e.createElement(A.gN,{as:q.o,name:`headers.${g}.value`,"aria-label":`row ${g+1} value`,label:n({id:"Settings.webhooks.value",defaultMessage:"Value"}),error:s.headers?.[g]?.value&&s.headers[g].value})),e.createElement(p.k,{paddingLeft:2,style:{alignSelf:"center"},paddingTop:s.headers?.[g]?.value?0:5},e.createElement(c.fG,{disabled:a.headers.length===1,onClick:()=>f(g),label:n({id:"Settings.webhooks.headers.remove",defaultMessage:"Remove header row {number}"},{number:g+1})})))))),e.createElement(R.P,{col:12},e.createElement(ee.A,{type:"button",onClick:()=>{u({key:"",value:""})},startIcon:e.createElement(oe.Z,null)},n({id:"Settings.webhooks.create.header",defaultMessage:"Create new header"}))))})))};var l=t(75515),C=t(86647),M=t(70968),k=t(71997);const O=k.ZP.svg(({theme:n,color:a})=>`
  width: ${12/16}rem;
  height: ${12/16}rem;

  path {
    fill: ${n.colors[a]};
  }
`),U=({isPending:n,statusCode:a})=>{const{formatMessage:s}=(0,I.Z)();return n?e.createElement(p.k,{gap:2,alignItems:"center"},e.createElement(O,{as:C.Z}),e.createElement(l.Z,null,s({id:"Settings.webhooks.trigger.pending",defaultMessage:"pending"}))):a>=200&&a<300?e.createElement(p.k,{gap:2,alignItems:"center"},e.createElement(O,{as:z.Z,color:"success700"}),e.createElement(l.Z,null,s({id:"Settings.webhooks.trigger.success",defaultMessage:"success"}))):a>=300?e.createElement(p.k,{gap:2,alignItems:"center"},e.createElement(O,{as:M.Z,color:"danger700"}),e.createElement(l.Z,null,s({id:"Settings.error",defaultMessage:"error"})," ",a)):null};U.propTypes={isPending:E().bool.isRequired,statusCode:E().number},U.defaultProps={statusCode:void 0};const V=({statusCode:n,message:a})=>{const{formatMessage:s}=(0,I.Z)();return n>=200&&n<300?e.createElement(p.k,{justifyContent:"flex-end"},e.createElement(l.Z,{textColor:"neutral600",ellipsis:!0},s({id:"Settings.webhooks.trigger.success.label",defaultMessage:"Trigger succeeded"}))):n>=300?e.createElement(p.k,{justifyContent:"flex-end"},e.createElement(p.k,{maxWidth:(0,c.Q1)(250),justifyContent:"flex-end",title:a},e.createElement(l.Z,{ellipsis:!0,textColor:"neutral600"},a))):null};V.propTypes={statusCode:E().number,message:E().string},V.defaultProps={statusCode:void 0,message:void 0};const x=({onCancel:n})=>{const{formatMessage:a}=(0,I.Z)();return e.createElement(p.k,{justifyContent:"flex-end"},e.createElement("button",{onClick:n,type:"button"},e.createElement(p.k,{gap:2,alignItems:"center"},e.createElement(l.Z,{textColor:"neutral400"},a({id:"Settings.webhooks.trigger.cancel",defaultMessage:"cancel"})),e.createElement(O,{as:M.Z,color:"neutral400"}))))};x.propTypes={onCancel:E().func.isRequired};const j=({isPending:n,onCancel:a,response:s})=>{const{statusCode:u,message:f}=s,{formatMessage:L}=(0,I.Z)();return e.createElement(X.x,{background:"neutral0",padding:5,shadow:"filterShadow",hasRadius:!0},e.createElement(_.r,{gap:4,style:{alignItems:"center"}},e.createElement(R.P,{col:3},e.createElement(l.Z,null,L({id:"Settings.webhooks.trigger.test",defaultMessage:"Test-trigger"}))),e.createElement(R.P,{col:3},e.createElement(U,{isPending:n,statusCode:u})),e.createElement(R.P,{col:6},n?e.createElement(x,{onCancel:a}):e.createElement(V,{statusCode:u,message:f}))))};j.defaultProps={isPending:!1,onCancel(){},response:{}},j.propTypes={isPending:E().bool,onCancel:E().func,response:E().object};const b=j;var d=t(87561);const S=/(^$)|(^[A-Za-z][_0-9A-Za-z ]*$)/,G=/(^$)|((https?:\/\/.*)(d*)\/?(.*))/,Ce=({formatMessage:n})=>d.Ry().shape({name:d.Z_().required(n({id:"Settings.webhooks.validation.name",defaultMessage:"Name is required"})).matches(S,c.I0.regex),url:d.Z_().required(n({id:"Settings.webhooks.validation.url.required",defaultMessage:"Url is required"})).matches(G,n({id:c.I0.regex,defaultMessage:"The value does not match the regex"})),headers:d.Vo(a=>{let s=d.IX();if(a.length===1){const{key:u,value:f}=a[0];if(!u&&!f)return s}return s.of(d.Ry().shape({key:d.Z_().required(n({id:"Settings.webhooks.validation.key",defaultMessage:"Key is required"})),value:d.Z_().required(n({id:"Settings.webhooks.validation.value",defaultMessage:"Value is required"}))}))}),events:d.IX()});var Me=function(){return window&&window.strapi&&window.strapi.isEE?t(65224).Z:t(93016).Z}(),he=function(a){var s,u,f=a.handleSubmit,L=a.triggerWebhook,g=a.isCreating,K=a.isTriggering,ae=a.triggerResponse,r=a.data,w=(0,I.Z)(),Z=w.formatMessage,se=(0,e.useState)(!1),ie=(0,Y.Z)(se,2),ve=ie[0],de=ie[1],pe=function(F){return Object.keys(F).length?Object.entries(F).map(function(Q){var y=(0,Y.Z)(Q,2),D=y[0],be=y[1];return{key:D,value:be}}):[{key:"",value:""}]},T=(0,A.TA)({initialValues:{name:r?.name||"",url:r?.url||"",headers:pe(r?.headers||{}),events:r?.events||[]},onSubmit:function(F,Q){var y=Q.resetForm,D=Q.setSubmitting;f(F),y({values:F}),D(!1)},validationSchema:Ce({formatMessage:Z}),validateOnChange:!1,validateOnBlur:!1});return e.createElement(A.Hy,{value:T},e.createElement(c.l0,{onSubmit:T.handleSubmit},e.createElement(W.T,{primaryAction:e.createElement(p.k,{gap:2},e.createElement(J.z,{onClick:function(){L(),de(!0)},variant:"tertiary",startIcon:e.createElement(P.Z,null),disabled:g||K,size:"L"},Z({id:"Settings.webhooks.trigger",defaultMessage:"Trigger"})),e.createElement(J.z,{startIcon:e.createElement(z.Z,null),type:"submit",size:"L",disabled:!T.dirty,loading:T.isSubmitting},Z({id:"global.save",defaultMessage:"Save"}))),title:g?Z({id:"Settings.webhooks.create",defaultMessage:"Create a webhook"}):r?.name,navigationAction:e.createElement(c.rU,{startIcon:e.createElement(ue.Z,null),to:"/settings/webhooks"},Z({id:"global.back",defaultMessage:"Back"}))}),e.createElement(ce.D,null,e.createElement(p.k,{direction:"column",alignItems:"stretch",gap:4},ve&&e.createElement(b,{isPending:K,response:ae,onCancel:function(){return de(!1)}}),e.createElement(X.x,{background:"neutral0",padding:8,shadow:"filterShadow",hasRadius:!0},e.createElement(p.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(_.r,{gap:6},e.createElement(R.P,{col:6},e.createElement(A.gN,{as:q.o,name:"name",error:(T==null||(s=T.errors)===null||s===void 0?void 0:s.name)&&T.errors.name,label:Z({id:"global.name",defaultMessage:"Name"}),required:!0})),e.createElement(R.P,{col:12},e.createElement(A.gN,{as:q.o,name:"url",error:(T==null||(u=T.errors)===null||u===void 0?void 0:u.url)&&T.errors.url,label:Z({id:"Settings.roles.form.input.url",defaultMessage:"Url"}),required:!0}))),e.createElement(i,null),e.createElement(Me,null)))))))};he.propTypes={data:E().object,handleSubmit:E().func.isRequired,triggerWebhook:E().func.isRequired,isCreating:E().bool.isRequired,isTriggering:E().bool.isRequired,triggerResponse:E().object},he.defaultProps={data:void 0,triggerResponse:void 0};const ye=he,fe=n=>({...n,headers:n.headers.reduce((a,{key:s,value:u})=>(s!==""&&(a[s]=u),a),{})}),Pe=()=>{const{params:{id:n}}=(0,N.$B)("/settings/webhooks/:id"),a=n==="create",{replace:s}=(0,N.k6)(),u=(0,c.lm)(),{formatAPIError:f}=(0,c.So)(),L=(0,v.useQueryClient)(),{isLoading:g}=(0,H.G)(),{put:K,get:ae,post:r}=(0,c.kY)(),{isLoading:w,data:Z,error:se}=(0,v.useQuery)(["webhooks",n],async()=>{const{data:{data:y}}=await ae(`/admin/webhooks/${n}`);return y},{enabled:!a});e.useEffect(()=>{se&&u({type:"warning",message:f(se)})},[se,u,f]);const{isLoading:ie,data:ve,isIdle:de,mutate:pe}=(0,v.useMutation)(()=>r(`/admin/webhooks/${n}/trigger`)),T=()=>pe(null,{onError(y){u({type:"warning",message:f(y)})}}),re=(0,v.useMutation)(y=>r("/admin/webhooks",y)),F=(0,v.useMutation)(({id:y,body:D})=>K(`/admin/webhooks/${y}`,D)),Q=async y=>{if(a){re.mutate(fe(y),{onSuccess({data:D}){u({type:"success",message:{id:"Settings.webhooks.created"}}),s(`/settings/webhooks/${D.data.id}`)},onError(D){u({type:"warning",message:f(D)})}});return}F.mutate({id:n,body:fe(y)},{onSuccess(){L.invalidateQueries(["webhooks",n]),u({type:"success",message:{id:"notification.form.success.fields"}})},onError(D){u({type:"warning",message:f(D)})}})};return w||g?e.createElement(c.dO,null):e.createElement(m.o,null,e.createElement(c.SL,{name:"Webhooks"}),e.createElement(ye,{data:Z,handleSubmit:Q,triggerWebhook:T,isCreating:a,isTriggering:ie,isTriggerIdle:de,triggerResponse:ve?.data.data}))}},3672:($,h,t)=>{t.r(h),t.d(h,{default:()=>H});var e=t(67294),m=t(60698),c=t(87751),v=t(41128);const H=()=>e.createElement(m.O4,{permissions:c.Z.settings.webhooks.create},e.createElement(v.Z,null))},42122:($,h,t)=>{t.r(h),t.d(h,{default:()=>H});var e=t(67294),m=t(60698),c=t(87751),v=t(41128);const H=()=>e.createElement(m.O4,{permissions:c.Z.settings.webhooks.update},e.createElement(v.Z,null))},65224:($,h,t)=>{t.d(h,{Z:()=>v});var e=t(67294),m=t(84714);function c(){return e.createElement(m.Z.Root,null,e.createElement(m.Z.Headers,null),e.createElement(m.Z.Body,null))}const v=c},90608:($,h,t)=>{t.d(h,{O:()=>m});var e=t(29178);const m=e.Wx},67109:($,h,t)=>{t.d(h,{Z:()=>c});var e=t(85893);const m=v=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...v,children:(0,e.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),c=m}}]);
