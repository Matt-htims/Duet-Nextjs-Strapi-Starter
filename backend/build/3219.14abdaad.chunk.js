"use strict";(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[3219],{76539:(I,M,e)=>{e.d(M,{Z:()=>f});var t=e(67294),y=e(53979),c=e(11047),i=e(29728),s=e(60698),a=e(85018),l=e(67109),g=e(45697),n=e.n(g),E=e(86896),u=e(30815),o=e(51319);const d=({onRegenerate:R,idToRegenerate:v,backUrl:K,onError:r})=>{const{formatMessage:U}=(0,E.Z)(),[W,L]=(0,t.useState)(!1),{regenerateData:Z,isLoadingConfirmation:B}=(0,o.rW)(K,v,R,r),S=async()=>{Z(),L(!1)};return t.createElement(t.Fragment,null,t.createElement(i.z,{startIcon:t.createElement(u.Z,null),type:"button",size:"S",variant:"tertiary",onClick:()=>L(!0),name:"regenerate"},U({id:"Settings.tokens.regenerate",defaultMessage:"Regenerate"})),t.createElement(s.QH,{bodyText:{id:"Settings.tokens.popUpWarning.message",defaultMessage:"Are you sure you want to regenerate this token?"},iconRightButton:t.createElement(u.Z,null),isConfirmButtonLoading:B,isOpen:W,onToggleDialog:()=>L(!1),onConfirm:S,leftButtonText:{id:"Settings.tokens.Button.cancel",defaultMessage:"Cancel"},rightButtonText:{id:"Settings.tokens.Button.regenerate",defaultMessage:"Regenerate"},title:{id:"Settings.tokens.RegenerateDialog.title",defaultMessage:"Regenerate token"}}))};d.defaultProps={onRegenerate(){},onError:void 0},d.propTypes={onRegenerate:n().func,idToRegenerate:n().oneOfType([n().number,n().string]).isRequired,backUrl:n().string.isRequired,onError:n().func};const m=d,T=({title:R,token:v,setToken:K,canEditInputs:r,canRegenerate:U,isSubmitting:W,backUrl:L,regenerateUrl:Z,onErrorRegenerate:B})=>{const{formatMessage:S}=(0,E.Z)(),z=H=>{K({...v,accessKey:H})};return t.createElement(y.T,{title:v?.name||S(R),primaryAction:r?t.createElement(c.k,{gap:2},U&&v?.id&&t.createElement(m,{backUrl:Z,onRegenerate:z,idToRegenerate:v?.id,onError:B}),t.createElement(i.z,{disabled:W,loading:W,startIcon:t.createElement(a.Z,null),type:"submit",size:"S"},S({id:"global.save",defaultMessage:"Save"}))):U&&v?.id&&t.createElement(m,{onRegenerate:z,idToRegenerate:v?.id,backUrl:Z}),navigationAction:t.createElement(s.rU,{startIcon:t.createElement(l.Z,null),to:L},S({id:"global.back",defaultMessage:"Back"})),ellipsis:!0})};T.propTypes={token:n().shape({id:n().oneOfType([n().number,n().string]),type:n().string,lifespan:n().oneOfType([n().number,n().string]),name:n().string,accessKey:n().string,permissions:n().array,description:n().string,createdAt:n().string}),canEditInputs:n().bool.isRequired,canRegenerate:n().bool.isRequired,setToken:n().func.isRequired,isSubmitting:n().bool.isRequired,backUrl:n().string.isRequired,title:n().shape({id:n().string,label:n().string}).isRequired,regenerateUrl:n().string.isRequired,onErrorRegenerate:n().func},T.defaultProps={token:void 0,onErrorRegenerate:void 0};const f=T},60401:(I,M,e)=>{e.d(M,{Z:()=>E});var t=e(67294),y=e(40619),c=e(82562),i=e(75515),s=e(45697),a=e.n(s),l=e(86896),g=e(75056);const n=({token:u,errors:o,values:d,onChange:m,isCreating:T})=>{const{formatMessage:f}=(0,l.Z)();return t.createElement(t.Fragment,null,t.createElement(y.P,{name:"lifespan",label:f({id:"Settings.tokens.form.duration",defaultMessage:"Token duration"}),value:d.lifespan!==null?d.lifespan:"0",error:o.lifespan?f(o.lifespan?.id?o.lifespan:{id:o.lifespan,defaultMessage:o.lifespan}):null,onChange:R=>{m({target:{name:"lifespan",value:R}})},required:!0,disabled:!T,placeholder:"Select"},t.createElement(c.W,{value:"604800000"},f({id:"Settings.tokens.duration.7-days",defaultMessage:"7 days"})),t.createElement(c.W,{value:"2592000000"},f({id:"Settings.tokens.duration.30-days",defaultMessage:"30 days"})),t.createElement(c.W,{value:"7776000000"},f({id:"Settings.tokens.duration.90-days",defaultMessage:"90 days"})),t.createElement(c.W,{value:"0"},f({id:"Settings.tokens.duration.unlimited",defaultMessage:"Unlimited"}))),t.createElement(i.Z,{variant:"pi",textColor:"neutral600"},!T&&`${f({id:"Settings.tokens.duration.expiration-date",defaultMessage:"Expiration date"})}: ${(0,g.IX)(u?.createdAt,parseInt(d.lifespan,10))}`))};n.propTypes={errors:a().shape({lifespan:a().string}),onChange:a().func.isRequired,values:a().shape({lifespan:a().oneOfType([a().number,a().string])}).isRequired,isCreating:a().bool.isRequired,token:a().shape({id:a().oneOfType([a().number,a().string]),type:a().string,lifespan:a().string,name:a().string,accessKey:a().string,permissions:a().array,description:a().string,createdAt:a().string})},n.defaultProps={errors:{},token:{}};const E=n},24122:(I,M,e)=>{e.d(M,{Z:()=>E});var t=e(67294),y=e(12028),c=e(60698),i=e(65186),s=e(69427),a=e(45697),l=e.n(a),g=e(86896);const n=({token:u,tokenType:o})=>{const{formatMessage:d}=(0,g.Z)(),m=(0,c.lm)(),{trackUsage:T}=(0,c.rS)(),{copy:f}=(0,c.VP)(),R=v=>async()=>{await f(v)&&(T.current("didCopyTokenKey",{tokenType:o}),m({type:"success",message:{id:"Settings.tokens.notification.copied"}}))};return t.createElement(c.Y_,{endAction:u&&t.createElement("span",{style:{alignSelf:"start"}},t.createElement(y.h,{label:d({id:"app.component.CopyToClipboard.label",defaultMessage:"Copy to clipboard"}),onClick:R(u),noBorder:!0,icon:t.createElement(i.Z,null),style:{padding:0,height:"1rem"}})),title:u||d({id:"Settings.tokens.copy.editTitle",defaultMessage:"This token isn\u2019t accessible anymore."}),subtitle:d(u?{id:"Settings.tokens.copy.lastWarning",defaultMessage:"Make sure to copy this token, you won\u2019t be able to see it again!"}:{id:"Settings.tokens.copy.editMessage",defaultMessage:"For security reasons, you can only see your token once."}),icon:t.createElement(s.Z,null),iconBackground:"neutral100"})};n.defaultProps={token:null},n.propTypes={token:l().string,tokenType:l().string.isRequired};const E=n},40695:(I,M,e)=>{e.d(M,{Z:()=>l});var t=e(67294),y=e(61467),c=e(45697),i=e.n(c),s=e(86896);const a=({errors:g,values:n,onChange:E,canEditInputs:u})=>{const{formatMessage:o}=(0,s.Z)();return t.createElement(y.g,{label:o({id:"Settings.tokens.form.description",defaultMessage:"Description"}),id:"description",error:g.description?o(g.description?.id?g.description:{id:g.description,defaultMessage:g.description}):null,onChange:E,disabled:!u},n.description)};a.propTypes={errors:i().shape({description:i().string}),onChange:i().func.isRequired,canEditInputs:i().bool.isRequired,values:i().shape({description:i().string}).isRequired},a.defaultProps={errors:{}};const l=a},61053:(I,M,e)=>{e.d(M,{Z:()=>l});var t=e(67294),y=e(16364),c=e(45697),i=e.n(c),s=e(86896);const a=({errors:g,values:n,onChange:E,canEditInputs:u})=>{const{formatMessage:o}=(0,s.Z)();return t.createElement(y.o,{name:"name",error:g.name?o(g.name?.id?g.name:{id:g.name,defaultMessage:g.name}):null,label:o({id:"Settings.tokens.form.name",defaultMessage:"Name"}),onChange:E,value:n.name,disabled:!u,required:!0})};a.propTypes={errors:i().shape({name:i().string}),onChange:i().func.isRequired,canEditInputs:i().bool.isRequired,values:i().shape({name:i().string}).isRequired},a.defaultProps={errors:{}};const l=a},31065:(I,M,e)=>{e.d(M,{Z:()=>g});var t=e(67294),y=e(40619),c=e(82562),i=e(45697),s=e.n(i),a=e(86896);const l=({name:n,errors:E,values:u,onChange:o,canEditInputs:d,options:m,label:T})=>{const{formatMessage:f}=(0,a.Z)();return t.createElement(y.P,{name:n,label:f({id:T.id,defaultMessage:T.defaultMessage}),value:u&&u[n],error:E[n]?f(E[n]?.id?E[n]:{id:E[n],defaultMessage:E[n]}):null,onChange:o,placeholder:"Select",required:!0,disabled:!d},m&&m.map(({value:R,label:v})=>t.createElement(c.W,{key:R,value:R},f(v))))};l.propTypes={name:s().string,options:s().arrayOf(s().shape({label:s().shape({id:s().string,defaultMessage:s().string}),value:s().string})),errors:s().shape({type:s().string}),onChange:s().func.isRequired,canEditInputs:s().bool.isRequired,values:s().shape({type:s().string}).isRequired,label:s().shape({id:s().string,defaultMessage:s().string}).isRequired},l.defaultProps={name:"type",errors:{},options:[]};const g=l},47670:(I,M,e)=>{e.d(M,{Z:()=>t,f:()=>y});const t="api-token",y="transfer-token"},75056:(I,M,e)=>{e.d(M,{IX:()=>s,fK:()=>n,mk:()=>u});var t=e(6406),y=e(77349),c=e(51991);const s=(o,d,m="en")=>{if(d&&typeof d=="number"){const T=d/24/60/60/1e3;return(0,t.Z)((0,y.Z)(new Date(o),T),"PPP",{locale:c[m]})}return"Unlimited"};var a=e(60698),l=e(87561);const n=l.Ry().shape({name:l.Z_(a.I0.string).max(100).required(a.I0.required),type:l.Z_(a.I0.string).oneOf(["read-only","full-access","custom"]).required(a.I0.required),description:l.Z_().nullable(),lifespan:l.Rx().integer().min(0).nullable().defined(a.I0.required)}),u=o=>{const d={allActionsIds:[],permissions:[]};return d.permissions=Object.keys(o).map(m=>({apiId:m,label:m.split("::")[1],controllers:Object.keys(o[m].controllers).map(T=>({controller:T,actions:o[m].controllers[T].map(f=>{const R=`${m}.${T}.${f}`;return m.includes("api::")&&d.allActionsIds.push(R),{action:f,actionId:R}}).flat()})).flat()})),d}},53219:(I,M,e)=>{e.d(M,{Z:()=>te});var t=e(67294),y=e(185),c=e(49066),i=e(11047),s=e(60698),a=e(14916),l=e(86896),g=e(88767),n=e(16550),E=e(87751),u=e(19631),o=e(47670),d=e(76539),m=e(24122),T=e(41580),f=e(75515),R=e(11276),v=e(67819),K=e(45697),r=e.n(K),U=e(60401),W=e(40695),L=e(61053),Z=e(31065);const B=({errors:h,onChange:C,canEditInputs:x,isCreating:D,values:k,transferToken:P})=>{const{formatMessage:F}=(0,l.Z)(),G=[{value:"push",label:{id:"Settings.transferTokens.types.push",defaultMessage:"Push"}},{value:"pull",label:{id:"Settings.transferTokens.types.pull",defaultMessage:"Pull"}},{value:"push-pull",label:{id:"Settings.transferTokens.types.push-pull",defaultMessage:"Full Access"}}];return t.createElement(T.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},t.createElement(i.k,{direction:"column",alignItems:"stretch",gap:4},t.createElement(f.Z,{variant:"delta",as:"h2"},F({id:"global.details",defaultMessage:"Details"})),t.createElement(R.r,{gap:5},t.createElement(v.P,{key:"name",col:6,xs:12},t.createElement(L.Z,{errors:h,values:k,canEditInputs:x,onChange:C})),t.createElement(v.P,{key:"description",col:6,xs:12},t.createElement(W.Z,{errors:h,values:k,canEditInputs:x,onChange:C})),t.createElement(v.P,{key:"lifespan",col:6,xs:12},t.createElement(U.Z,{isCreating:D,errors:h,values:k,onChange:C,token:P})),t.createElement(v.P,{key:"permissions",col:6,xs:12},t.createElement(Z.Z,{name:"permissions",values:k,errors:h,label:{id:"Settings.tokens.form.type",defaultMessage:"Token type"},onChange:V=>{C({target:{name:"permissions",value:V}})},options:G,canEditInputs:x})))))};B.propTypes={errors:r().shape({name:r().string,description:r().string,lifespan:r().string,type:r().string}),onChange:r().func.isRequired,canEditInputs:r().bool.isRequired,values:r().shape({name:r().string,description:r().string,lifespan:r().oneOfType([r().number,r().string]),type:r().string}).isRequired,isCreating:r().bool.isRequired,transferToken:r().shape({id:r().oneOfType([r().number,r().string]),type:r().string,lifespan:r().string,name:r().string,accessKey:r().string,permissions:r().array,description:r().string,createdAt:r().string})},B.defaultProps={errors:{},transferToken:{}};const S=B;var z=e(53979),H=e(29728),b=e(85018);const j=({transferTokenName:h})=>{const{formatMessage:C}=(0,l.Z)();return(0,s.go)(),t.createElement(y.o,{"aria-busy":"true"},t.createElement(s.SL,{name:"Transfer Tokens"}),t.createElement(z.T,{primaryAction:t.createElement(H.z,{disabled:!0,startIcon:t.createElement(b.Z,null),type:"button",size:"L"},C({id:"global.save",defaultMessage:"Save"})),title:h||C({id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"})}),t.createElement(c.D,null,t.createElement(s.dO,null)))};j.defaultProps={transferTokenName:null},j.propTypes={transferTokenName:r().string};const q=j;var N=e(87561);const w=N.Ry().shape({name:N.Z_(s.I0.string).max(100).required(s.I0.required),description:N.Z_().nullable(),lifespan:N.Rx().integer().min(0).nullable().defined(s.I0.required),permissions:N.Z_(s.I0.string).required(s.I0.required)}),ee="Name already taken",te=()=>{(0,s.go)();const{formatMessage:h}=(0,l.Z)(),{lockApp:C,unlockApp:x}=(0,s.o1)(),D=(0,s.lm)(),k=(0,n.k6)(),[P,F]=(0,t.useState)(k.location.state?.transferToken.accessKey?{...k.location.state.transferToken}:null),{trackUsage:G}=(0,s.rS)(),V=(0,t.useRef)(G),{setCurrentStep:ne}=(0,s.c1)(),{allowedActions:{canCreate:se,canUpdate:ae,canRegenerate:re}}=(0,s.ss)(E.Z.settings["transfer-tokens"]),{params:{id:X}}=(0,n.$B)("/settings/transfer-tokens/:id"),{get:oe,post:ie,put:le}=(0,s.kY)(),O=X==="create",{formatAPIError:Q}=(0,s.So)();(0,t.useEffect)(()=>{V.current(O?"didAddTokenFromList":"didEditTokenFromList",{tokenType:o.f})},[O]);const{status:de}=(0,g.useQuery)(["transfer-token",X],async()=>{const{data:{data:p}}=await oe(`/admin/transfer/tokens/${X}`);return F({...p}),p},{enabled:!O&&!P,onError(p){p.response.data.error.details?.code==="INVALID_TOKEN_SALT"?D({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):D({type:"warning",message:Q(p)})}}),ce=async(p,$)=>{V.current(O?"willCreateToken":"willEditToken",{tokenType:o.f}),C();const _=p.lifespan&&parseInt(p.lifespan,10)&&p.lifespan!=="0"?parseInt(p.lifespan,10):null,Y=p.permissions.split("-");try{const{data:{data:A}}=O?await ie("/admin/transfer/tokens",{...p,lifespan:_,permissions:Y}):await le(`/admin/transfer/tokens/${X}`,{name:p.name,description:p.description,permissions:Y});x(),O&&(k.replace(`/settings/transfer-tokens/${A.id}`,{transferToken:A}),ne("transferTokens.success")),F({...A}),D({type:"success",message:h(O?{id:"notification.success.transfertokencreated",defaultMessage:"Transfer Token successfully created"}:{id:"notification.success.transfertokenedited",defaultMessage:"Transfer Token successfully edited"})}),V.current(O?"didCreateToken":"didEditToken",{type:P?.permissions,tokenType:o.f})}catch(A){const pe=(0,u.Iz)(A.response.data);$.setErrors(pe),A?.response?.data?.error?.message===ee?D({type:"warning",message:A.response.data.message||"notification.error.tokennamenotunique"}):A?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?D({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):D({type:"warning",message:A?.response?.data?.message||"notification.error"}),x()}},J=ae&&!O||se&&O;if(!O&&!P&&de!=="success")return t.createElement(q,{transferTokenName:P?.name});const ge=p=>{p?.response?.data?.error?.details?.code==="INVALID_TOKEN_SALT"?D({type:"warning",message:{id:"notification.error.invalid.configuration",defaultMessage:"You have an invalid configuration, check your server log for more information."}}):D({type:"warning",message:Q(p)})};return t.createElement(y.o,null,t.createElement(s.SL,{name:"Transfer Tokens"}),t.createElement(a.J9,{validationSchema:w,validateOnChange:!1,initialValues:{name:P?.name||"",description:P?.description||"",lifespan:P?.lifespan?P.lifespan.toString():P?.lifespan,permissions:P?.permissions.join("-")},enableReinitialize:!0,onSubmit:(p,$)=>ce(p,$)},({errors:p,handleChange:$,isSubmitting:_,values:Y})=>t.createElement(s.l0,null,t.createElement(d.Z,{backUrl:"/settings/transfer-tokens",title:{id:"Settings.transferTokens.createPage.title",defaultMessage:"Create Transfer Token"},token:P,setToken:F,canEditInputs:J,canRegenerate:re,isSubmitting:_,regenerateUrl:"/admin/transfer/tokens/",onErrorRegenerate:ge}),t.createElement(c.D,null,t.createElement(i.k,{direction:"column",alignItems:"stretch",gap:6},Boolean(P?.name)&&t.createElement(m.Z,{token:P?.accessKey,tokenType:o.f}),t.createElement(S,{errors:p,onChange:$,canEditInputs:J,isCreating:O,values:Y,transferToken:P}))))))}}}]);
