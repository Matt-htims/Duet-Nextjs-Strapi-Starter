(self.webpackChunkbackend=self.webpackChunkbackend||[]).push([[8853],{7842:(m,E,t)=>{"use strict";t.r(E),t.d(E,{default:()=>Lt});var e=t(67294),n=t(60698),o=t(16550),i=t(81912),l=t(31498),p=t(185),d=t(53979),A=t(29728),D=t(49066),v=t(11047),L=t(41580),h=t(75515),P=t(11276),T=t(67819),M=t(16364),b=t(61467),S=t(85018),U=t(14916),Z=t(86896),k=t(45697),B=t.n(k);const z=(0,e.createContext)({}),se=({children:s,value:r})=>e.createElement(z.Provider,{value:r},s),q=()=>(0,e.useContext)(z);se.propTypes={children:B().node.isRequired,value:B().object.isRequired};var K=t(84757),Ce=t(48734),Ae=t(74756),Pe=t(63081),Te=t(11700),Le=t.n(Te);function be(s){switch(s){case"application":return"Application";case"plugin::content-manager":return"Content manager";case"plugin::content-type-builder":return"Content types builder";case"plugin::documentation":return"Documentation";case"plugin::email":return"Email";case"plugin::i18n":return"i18n";case"plugin::upload":return"Upload";case"plugin::users-permissions":return"Users-permissions";default:return Le()(s.replace("api::","").replace("plugin::",""))}}const De=be,Me=(s,r)=>{const a=Object.keys(r).sort().map(c=>({name:c,isOpen:!1}));return{...s,collapses:a}};var Se=t(89734),ae=t.n(Se),re=t(36213),oe=t(63237),Ze=t(78114),Oe=t(27361),Y=t.n(Oe),Q=t(71997);const ie=(0,Q.iv)`
  background: ${s=>s.theme.colors.primary100};
  svg {
    opacity: 1;
  }
`,Be=(0,Q.ZP)(L.x)`
  display: flex;
  justify-content: space-between;
  align-items: center;

  svg {
    opacity: 0;
    path {
      fill: ${s=>s.theme.colors.primary600};
    }
  }

  /* Show active style both on hover and when the action is selected */
  ${s=>s.isActive&&ie}
  &:hover {
    ${ie}
  }
`,je=Q.ZP.div`
  flex: 1;
  align-self: center;
  border-top: 1px solid ${({theme:s})=>s.colors.neutral150};
`,le=({subCategory:s})=>{const{formatMessage:r}=(0,Z.Z)(),{onChange:a,onChangeSelectAll:c,onSelectedAction:f,selectedAction:u,modifiedData:R}=q(),x=(0,e.useMemo)(()=>Y()(R,s.name,{}),[R,s]),C=(0,e.useMemo)(()=>Object.values(x).every(g=>g.enabled===!0),[x]),y=(0,e.useMemo)(()=>Object.values(x).some(g=>g.enabled===!0)&&!C,[x,C]),j=(0,e.useCallback)(({target:{name:g}})=>{c({target:{name:g,value:!C}})},[C,c]),O=(0,e.useCallback)(g=>u===g,[u]);return e.createElement(L.x,null,e.createElement(v.k,{justifyContent:"space-between",alignItems:"center"},e.createElement(L.x,{paddingRight:4},e.createElement(h.Z,{variant:"sigma",textColor:"neutral600"},s.label)),e.createElement(je,null),e.createElement(L.x,{paddingLeft:4},e.createElement(re.X,{name:s.name,value:C,onValueChange:g=>j({target:{name:s.name,value:g}}),indeterminate:y},r({id:"app.utils.select-all",defaultMessage:"Select all"})))),e.createElement(v.k,{paddingTop:6,paddingBottom:6},e.createElement(P.r,{gap:2,style:{flex:1}},s.actions.map(g=>{const N=`${g.name}.enabled`;return e.createElement(T.P,{col:6,key:g.name},e.createElement(Be,{isActive:O(g.name),padding:2,hasRadius:!0},e.createElement(re.X,{value:Y()(R,N,!1),name:N,onValueChange:G=>a({target:{name:N,value:G}})},g.label),e.createElement("button",{type:"button",onClick:()=>f(g.name),style:{display:"inline-flex",alignItems:"center"}},e.createElement(oe.T,{as:"span"},r({id:"app.utils.show-bound-route",defaultMessage:"Show bound route for {route}"},{route:g.name})),e.createElement(Ze.Z,null))))}))))};le.propTypes={subCategory:B().object.isRequired};const Ue=le,ce=({name:s,permissions:r})=>{const a=(0,e.useMemo)(()=>ae()(Object.values(r.controllers).reduce((c,f,u)=>{const R=`${s}.controllers.${Object.keys(r.controllers)[u]}`,x=ae()(Object.keys(f).reduce((C,y)=>[...C,{...f[y],label:y,name:`${R}.${y}`}],[]),"label");return[...c,{actions:x,label:Object.keys(r.controllers)[u],name:R}]},[]),"label"),[s,r]);return e.createElement(L.x,{padding:6},a.map(c=>e.createElement(Ue,{key:c.name,subCategory:c})))};ce.propTypes={name:B().string.isRequired,permissions:B().object.isRequired};const Ie=ce;var _=t(18172);const ke={collapses:[]},Ne=(s,r)=>(0,_.ZP)(s,a=>{switch(r.type){case"TOGGLE_COLLAPSE":{a.collapses=s.collapses.map((c,f)=>f===r.index?{...c,isOpen:!c.isOpen}:{...c,isOpen:!1});break}default:return a}}),$e=()=>{const{modifiedData:s}=q(),{formatMessage:r}=(0,Z.Z)(),[{collapses:a},c]=(0,e.useReducer)(Ne,ke,u=>Me(u,s)),f=u=>c({type:"TOGGLE_COLLAPSE",index:u});return e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:1},a.map((u,R)=>e.createElement(Ce.U,{expanded:u.isOpen,onToggle:()=>f(R),key:u.name,variant:R%2===0?"secondary":void 0},e.createElement(Ae.B,{title:De(u.name),description:r({id:"users-permissions.Plugin.permissions.plugins.description",defaultMessage:"Define all allowed actions for the {name} plugin."},{name:u.name}),variant:R%2?"primary":"secondary"}),e.createElement(Pe.v,null,e.createElement(L.x,null,e.createElement(Ie,{permissions:s[u.name],name:u.name}))))))};var Fe=t(41609),Ge=t.n(Fe),we=t(82569),We=t.n(we),He=t(35161),Ke=t.n(He),Ve=t(13217),ze=t.n(Ve);const Ye=s=>{switch(s){case"POST":return{text:"success600",border:"success200",background:"success100"};case"GET":return{text:"secondary600",border:"secondary200",background:"secondary100"};case"PUT":return{text:"warning600",border:"warning200",background:"warning100"};case"DELETE":return{text:"danger600",border:"danger200",background:"danger100"};default:return{text:"neutral600",border:"neutral200",background:"neutral100"}}},Qe=(0,Q.ZP)(L.x)`
  margin: -1px;
  border-radius: ${({theme:s})=>s.spaces[1]} 0 0 ${({theme:s})=>s.spaces[1]};
`;function ee({route:s}){const{formatMessage:r}=(0,Z.Z)(),{method:a,handler:c,path:f}=s,u=f?ze()(f.split("/")):[],[R="",x=""]=c?c.split("."):[],C=Ye(s.method);return e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(h.Z,{variant:"delta",as:"h3"},r({id:"users-permissions.BoundRoute.title",defaultMessage:"Bound route to"}),"\xA0",e.createElement("span",null,R),e.createElement(h.Z,{variant:"delta",textColor:"primary600"},".",x)),e.createElement(v.k,{hasRadius:!0,background:"neutral0",borderColor:"neutral200",gap:0},e.createElement(Qe,{background:C.background,borderColor:C.border,padding:2},e.createElement(h.Z,{fontWeight:"bold",textColor:C.text},a)),e.createElement(L.x,{paddingLeft:2,paddingRight:2},Ke()(u,y=>e.createElement(h.Z,{key:y,textColor:y.includes(":")?"neutral600":"neutral900"},"/",y)))))}ee.defaultProps={route:{handler:"Nocontroller.error",method:"GET",path:"/there-is-no-path"}},ee.propTypes={route:B().shape({handler:B().string,method:B().string,path:B().string})};const Xe=ee,Je=()=>{const{formatMessage:s}=(0,Z.Z)(),{selectedAction:r,routes:a}=q(),c=We()(r.split("."),"controllers"),f=Y()(a,c[0]),u=c.slice(1).join("."),R=Ge()(f)?[]:f.filter(x=>x.handler.endsWith(u));return e.createElement(T.P,{col:5,background:"neutral150",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7,style:{minHeight:"100%"}},r?e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:2},R.map((x,C)=>e.createElement(Xe,{key:C,route:x}))):e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(h.Z,{variant:"delta",as:"h3"},s({id:"users-permissions.Policies.header.title",defaultMessage:"Advanced settings"})),e.createElement(h.Z,{as:"p",textColor:"neutral600"},s({id:"users-permissions.Policies.header.hint",defaultMessage:"Select the application's actions or the plugin's actions and click on the cog icon to display the bound route"}))))},qe=(s,r,a)=>({...s,initialData:r,modifiedData:r,routes:a});var _e=t(36968),de=t.n(_e),et=t(69572),tt=t.n(et);const nt={initialData:{},modifiedData:{},routes:{},selectedAction:"",policies:[]},st=(s,r)=>(0,_.ZP)(s,a=>{switch(r.type){case"ON_CHANGE":{const c=r.keys.length,f=r.keys[c-1]==="enabled";if(r.value&&f){const u=tt()(r.keys,c-1).join(".");a.selectedAction=u}de()(a,["modifiedData",...r.keys],r.value);break}case"ON_CHANGE_SELECT_ALL":{const c=["modifiedData",...r.keys],f=Y()(s,c,{}),u=Object.keys(f).reduce((R,x)=>(R[x]={...f[x],enabled:r.value},R),{});de()(a,c,u);break}case"ON_RESET":{a.modifiedData=s.initialData;break}case"ON_SUBMIT_SUCCEEDED":{a.initialData=s.modifiedData;break}case"SELECT_ACTION":{const{actionToSelect:c}=r;a.selectedAction=c===s.selectedAction?"":c;break}default:return a}}),ue=(0,e.forwardRef)(({permissions:s,routes:r},a)=>{const{formatMessage:c}=(0,Z.Z)(),[f,u]=(0,e.useReducer)(st,nt,j=>qe(j,s,r));(0,e.useImperativeHandle)(a,()=>({getPermissions(){return{permissions:f.modifiedData}},resetForm(){u({type:"ON_RESET"})},setFormAfterSubmit(){u({type:"ON_SUBMIT_SUCCEEDED"})}}));const y={...f,onChange:({target:{name:j,value:O}})=>u({type:"ON_CHANGE",keys:j.split("."),value:O==="empty__string_value"?"":O}),onChangeSelectAll:({target:{name:j,value:O}})=>u({type:"ON_CHANGE_SELECT_ALL",keys:j.split("."),value:O}),onSelectedAction:j=>u({type:"SELECT_ACTION",actionToSelect:j})};return e.createElement(se,{value:y},e.createElement(P.r,{gap:0,shadow:"filterShadow",hasRadius:!0,background:"neutral0"},e.createElement(T.P,{col:7,paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:6},e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:2},e.createElement(h.Z,{variant:"delta",as:"h2"},c({id:(0,K.Z)("Plugins.header.title"),defaultMessage:"Permissions"})),e.createElement(h.Z,{as:"p",textColor:"neutral600"},c({id:(0,K.Z)("Plugins.header.description"),defaultMessage:"Only actions bound by a route are listed below."}))),e.createElement($e,null))),e.createElement(Je,null)))});ue.propTypes={permissions:B().object.isRequired,routes:B().object.isRequired};const me=(0,e.memo)(ue);var W=t(89031);const Kt={isLoading:!0,modifiedData:{}},Vt=(s,r)=>produce(s,a=>{switch(r.type){case"GET_DATA":{a.isLoading=!0,a.modifiedData={};break}case"GET_DATA_SUCCEEDED":{a.isLoading=!1,a.modifiedData=r.data;break}case"GET_DATA_ERROR":{a.isLoading=!0;break}case"ON_SUBMIT_SUCCEEDED":{a.modifiedData=r.data;break}default:return a}}),zt=null,Yt=(s,r)=>{const{isLoading:a,allowedActions:c}=useRBAC(r),[{isLoading:f,modifiedData:u},R]=useReducer(reducer,initialState),x=useNotification(),C=useRef(!0),{get:y}=useFetchClient();useEffect(()=>(a||(async()=>{try{R({type:"GET_DATA"});const{data:g}=await y(getRequestURL(s));R({type:"GET_DATA_SUCCEEDED",data:g})}catch(g){C.current&&(R({type:"GET_DATA_ERROR"}),console.error(g),x({type:"warning",message:{id:"notification.error"}}))}})(),()=>{C.current=!1}),[a,s,y,x]);const j=useCallback(O=>{R({type:"ON_SUBMIT_SUCCEEDED",data:O})},[]);return{allowedActions:c,dispatchSubmitSucceeded:j,isLoading:f,isLoadingForPermissions:a,modifiedData:u}},Qt=null,Xt={roles:[],isLoading:!0},Jt=(s,r)=>produce(s,a=>{switch(r.type){case"GET_DATA":{a.isLoading=!0,a.roles=[];break}case"GET_DATA_SUCCEEDED":{a.roles=r.data,a.isLoading=!1;break}case"GET_DATA_ERROR":{a.isLoading=!1;break}default:return a}}),qt=null,_t=(s=!0)=>{const[{roles:r,isLoading:a},c]=useReducer(reducer,initialState,()=>init(initialState,s)),f=useNotification(),u=useRef(!0),R=useFetchClient(),x=useCallback(async()=>{try{c({type:"GET_DATA"});const{data:{roles:C}}=await R.get(`/${pluginId}/roles`);c({type:"GET_DATA_SUCCEEDED",data:C})}catch(C){const y=get(C,["response","payload","message"],"An error occured");u.current&&(c({type:"GET_DATA_ERROR"}),y!=="Forbidden"&&f({type:"warning",message:y}))}},[R,f]);return useEffect(()=>(s&&x(),()=>{u.current=!1}),[s,x]),{roles:r,isLoading:a,getData:x}},en=null;var X=t(88767);const ge=()=>{const s=(0,n.lm)(),{get:r}=(0,n.kY)(),{formatAPIError:a}=(0,n.So)(W.OB),[{data:c,isLoading:f,error:u,refetch:R},{data:x,isLoading:C,error:y,refetch:j}]=(0,X.useQueries)([{queryKey:[l.Z,"permissions"],async queryFn(){return(await r(`/${l.Z}/permissions`)).data.permissions}},{queryKey:[l.Z,"routes"],async queryFn(){return(await r(`/${l.Z}/routes`)).data.routes}}]),O=async()=>{await Promise.all([R(),j()])};(0,e.useEffect)(()=>{u&&s({type:"warning",message:a(u)})},[s,u,a]),(0,e.useEffect)(()=>{y&&s({type:"warning",message:a(y)})},[s,y,a]);const g=f||C;return{permissions:c?(0,W.YX)(c):{},routes:x??{},getData:O,isLoading:g}},at={role:{},isLoading:!0},rt=(s,r)=>(0,_.ZP)(s,a=>{switch(r.type){case"GET_DATA_SUCCEEDED":{a.role=r.role,a.isLoading=!1;break}case"GET_DATA_ERROR":{a.isLoading=!1;break}case"ON_SUBMIT_SUCCEEDED":{a.role.name=r.name,a.role.description=r.description;break}default:return a}}),ot=s=>{const[r,a]=(0,e.useReducer)(rt,at),c=(0,n.lm)(),f=(0,e.useRef)(null),{get:u}=(0,n.kY)();(0,e.useEffect)(()=>(f.current=!0,s?R(s):a({type:"GET_DATA_SUCCEEDED",role:{}}),()=>f.current=!1),[s]);const R=async C=>{try{const{data:{role:y}}=await u(`/${l.Z}/roles/${C}`);f.current&&a({type:"GET_DATA_SUCCEEDED",role:y})}catch(y){console.error(y),a({type:"GET_DATA_ERROR"}),c({type:"warning",message:{id:"notification.error"}})}},x=(0,e.useCallback)(C=>{a({type:"ON_SUBMIT_SUCCEEDED",...C})},[]);return{...r,onSubmitSucceeded:x}};var te=t(87561);const pe=te.Ry().shape({name:te.Z_().required(n.I0.required),description:te.Z_().required(n.I0.required)}),it=()=>{const{formatMessage:s}=(0,Z.Z)(),[r,a]=(0,e.useState)(!1),c=(0,n.lm)(),{goBack:f}=(0,o.k6)(),{lockApp:u,unlockApp:R}=(0,n.o1)(),{isLoading:x,permissions:C,routes:y}=ge(),{trackUsage:j}=(0,n.rS)(),O=(0,e.useRef)(),{post:g}=(0,n.kY)(),N=async G=>{u(),a(!0);try{const I=O.current.getPermissions();await g(`/${l.Z}/roles`,{...G,...I,users:[]}),j("didCreateRole"),c({type:"success",message:{id:(0,K.Z)("Settings.roles.created"),defaultMessage:"Role created"}}),f()}catch(I){console.error(I),c({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}a(!1),R()};return e.createElement(p.o,null,e.createElement(n.SL,{name:"Roles"}),e.createElement(U.J9,{enableReinitialize:!0,initialValues:{name:"",description:""},onSubmit:N,validationSchema:pe},({handleSubmit:G,values:I,handleChange:$,errors:F})=>e.createElement(n.l0,{noValidate:!0,onSubmit:G},e.createElement(d.T,{primaryAction:!x&&e.createElement(A.z,{type:"submit",loading:r,startIcon:e.createElement(S.Z,null)},s({id:"global.save",defaultMessage:"Save"})),title:s({id:"Settings.roles.create.title",defaultMessage:"Create a role"}),subtitle:s({id:"Settings.roles.create.description",defaultMessage:"Define the rights given to the role"})}),e.createElement(D.D,null,e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:7},e.createElement(L.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(h.Z,{variant:"delta",as:"h2"},s({id:(0,K.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),e.createElement(P.r,{gap:4},e.createElement(T.P,{col:6},e.createElement(M.o,{name:"name",value:I.name||"",onChange:$,label:s({id:"global.name",defaultMessage:"Name"}),error:F.name?s({id:F.name,defaultMessage:"Invalid value"}):null})),e.createElement(T.P,{col:6},e.createElement(b.g,{id:"description",value:I.description||"",onChange:$,label:s({id:"global.description",defaultMessage:"Description"}),error:F.description?s({id:F.description,defaultMessage:"Invalid value"}):null}))))),!x&&e.createElement(me,{ref:O,permissions:C,routes:y}))))))},lt=()=>e.createElement(n.O4,{permissions:i.Z.createRole},e.createElement(it,null));var ct=t(67109);const dt=()=>{const{formatMessage:s}=(0,Z.Z)(),[r,a]=(0,e.useState)(!1),c=(0,n.lm)(),{lockApp:f,unlockApp:u}=(0,n.o1)(),{params:{id:R}}=(0,o.$B)(`/settings/${l.Z}/roles/:id`),{isLoading:x,routes:C}=ge(),{role:y,onSubmitSucceeded:j,isLoading:O}=ot(R),g=(0,e.useRef)(),{put:N}=(0,n.kY)(),G=async I=>{f(),a(!0);try{const $=g.current.getPermissions();await N(`/${l.Z}/roles/${R}`,{...I,...$,users:[]}),j({name:I.name,description:I.description}),c({type:"success",message:{id:(0,K.Z)("Settings.roles.edited"),defaultMessage:"Role edited"}})}catch($){console.error($),c({type:"warning",message:{id:"notification.error",defaultMessage:"An error occurred"}})}a(!1),u()};return O?e.createElement(n.dO,null):e.createElement(p.o,null,e.createElement(n.SL,{name:"Roles"}),e.createElement(U.J9,{enableReinitialize:!0,initialValues:{name:y.name,description:y.description},onSubmit:G,validationSchema:pe},({handleSubmit:I,values:$,handleChange:F,errors:V})=>e.createElement(n.l0,{noValidate:!0,onSubmit:I},e.createElement(d.T,{primaryAction:!x&&e.createElement(A.z,{disabled:y.code==="strapi-super-admin",type:"submit",loading:r,startIcon:e.createElement(S.Z,null)},s({id:"global.save",defaultMessage:"Save"})),title:y.name,subtitle:y.description,navigationAction:e.createElement(n.rU,{startIcon:e.createElement(ct.Z,null),to:"/settings/users-permissions/roles"},s({id:"global.back",defaultMessage:"Back"}))}),e.createElement(D.D,null,e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:7},e.createElement(L.x,{background:"neutral0",hasRadius:!0,shadow:"filterShadow",paddingTop:6,paddingBottom:6,paddingLeft:7,paddingRight:7},e.createElement(v.k,{direction:"column",alignItems:"stretch",gap:4},e.createElement(h.Z,{variant:"delta",as:"h2"},s({id:(0,K.Z)("EditPage.form.roles"),defaultMessage:"Role details"})),e.createElement(P.r,{gap:4},e.createElement(T.P,{col:6},e.createElement(M.o,{name:"name",value:$.name||"",onChange:F,label:s({id:"global.name",defaultMessage:"Name"}),error:V.name?s({id:V.name,defaultMessage:"Invalid value"}):null})),e.createElement(T.P,{col:6},e.createElement(b.g,{id:"description",value:$.description||"",onChange:F,label:s({id:"global.description",defaultMessage:"Description"}),error:V.description?s({id:V.description,defaultMessage:"Invalid value"}):null}))))),!x&&e.createElement(me,{ref:g,permissions:y.permissions,routes:C}))))))},ut=()=>e.createElement(n.O4,{permissions:i.Z.updateRole},e.createElement(dt,null));var mt=t(14087),gt=t(17034),pt=t(36989),ht=t(38939),Et=t(8060),he=t(79031),w=t(37909),ft=t(96315),vt=t(15234),Ee=t(12028),yt=t(4585),Rt=t(20022);const ne=({sortedRoles:s,canDelete:r,permissions:a,setRoleToDelete:c,onDelete:f})=>{const{formatMessage:u}=(0,Z.Z)(),{push:R}=(0,o.k6)(),[x,C]=f,y=g=>r&&!["public","authenticated"].includes(g.type),j=g=>{c(g),C(!x)},O=g=>{R(`/settings/${l.Z}/roles/${g}`)};return e.createElement(vt.p,null,s?.map(g=>e.createElement(he.Tr,{key:g.name,...(0,n.X7)({fn:()=>O(g.id)})},e.createElement(w.Td,{width:"20%"},e.createElement(h.Z,null,g.name)),e.createElement(w.Td,{width:"50%"},e.createElement(h.Z,null,g.description)),e.createElement(w.Td,{width:"30%"},e.createElement(h.Z,null,`${g.nb_users} ${u({id:"global.users",defaultMessage:"users"}).toLowerCase()}`)),e.createElement(w.Td,null,e.createElement(v.k,{justifyContent:"end",...n.UW},e.createElement(n.jW,{permissions:a.updateRole},e.createElement(Ee.h,{onClick:()=>O(g.id),noBorder:!0,icon:e.createElement(yt.Z,null),label:u({id:"app.component.table.edit",defaultMessage:"Edit {target}"},{target:`${g.name}`})})),y(g)&&e.createElement(n.jW,{permissions:a.deleteRole},e.createElement(Ee.h,{onClick:()=>j(g.id),noBorder:!0,icon:e.createElement(Rt.Z,null),label:u({id:"global.delete-target",defaultMessage:"Delete {target}"},{target:`${g.name}`})})))))))},xt=ne;ne.defaultProps={canDelete:!1},ne.propTypes={onDelete:B().array.isRequired,permissions:B().object.isRequired,setRoleToDelete:B().func.isRequired,sortedRoles:B().array.isRequired,canDelete:B().bool};const Ct=async(s,r)=>{try{const{get:a}=(0,n.tg)(),{data:c}=await a((0,W.Gc)("roles"));return r("The roles have loaded successfully"),c}catch(a){throw s({type:"warning",message:{id:"notification.error"}}),new Error(a)}},At=async(s,r)=>{try{const{del:a}=(0,n.tg)();await a(`${(0,W.Gc)("roles")}/${s}`)}catch{r({type:"warning",message:{id:"notification.error",defaultMessage:"An error occured"}})}},Pt=()=>{const{trackUsage:s}=(0,n.rS)(),{formatMessage:r,locale:a}=(0,Z.Z)(),{push:c}=(0,o.k6)(),f=(0,n.lm)(),{notifyStatus:u}=(0,mt.G)(),[{query:R}]=(0,n.Kx)(),x=R?._q||"",[C,y]=(0,e.useState)(!1),[j,O]=(0,e.useState)(!1),[g,N]=(0,e.useState)();(0,n.go)();const G=(0,X.useQueryClient)(),I=(0,e.useMemo)(()=>({create:i.Z.createRole,read:i.Z.readRoles,update:i.Z.updateRole,delete:i.Z.deleteRole}),[]),{isLoading:$,allowedActions:{canRead:F,canDelete:V}}=(0,n.ss)(I),{isLoading:bt,data:{roles:fe},isFetching:Dt}=(0,X.useQuery)("get-roles",()=>Ct(f,u),{initialData:{},enabled:F}),{includes:ve}=(0,n.L0)(a,{sensitivity:"base"}),ye=(0,n.Xe)(a,{sensitivity:"base"}),Re=bt||Dt,Mt=()=>{s("willCreateRole"),c(`/settings/${l.Z}/roles/new`)},St=()=>{y(!C)},Zt={roles:{id:(0,W.OB)("Roles.empty"),defaultMessage:"You don't have any roles yet."},search:{id:(0,W.OB)("Roles.empty.search"),defaultMessage:"No roles match the search."}},Ot=r({id:"global.roles",defaultMessage:"Roles"}),Bt=(0,X.useMutation)(H=>At(H,f),{async onSuccess(){await G.invalidateQueries("get-roles")}}),jt=async()=>{O(!0),await Bt.mutateAsync(g),y(!C),O(!1)},J=(fe||[]).filter(H=>ve(H.name,x)||ve(H.description,x)).sort((H,xe)=>ye.compare(H.name,xe.name)||ye.compare(H.description,xe.description)),Ut=x&&!J.length?"search":"roles",It=4,kt=(fe?.length||0)+1;return e.createElement(gt.A,null,e.createElement(n.SL,{name:Ot}),e.createElement(p.o,{"aria-busy":Re},e.createElement(d.T,{title:r({id:"global.roles",defaultMessage:"Roles"}),subtitle:r({id:"Settings.roles.list.description",defaultMessage:"List of roles"}),primaryAction:e.createElement(n.jW,{permissions:i.Z.createRole},e.createElement(A.z,{onClick:Mt,startIcon:e.createElement(ft.Z,null),size:"S"},r({id:(0,W.OB)("List.button.roles"),defaultMessage:"Add new role"})))}),e.createElement(pt.Z,{startActions:e.createElement(n.m,{label:r({id:"app.component.search.label",defaultMessage:"Search"})})}),e.createElement(D.D,null,!F&&e.createElement(n.ZF,null),(Re||$)&&e.createElement(n.dO,null),F&&J&&J?.length?e.createElement(ht.i,{colCount:It,rowCount:kt},e.createElement(Et.h,null,e.createElement(he.Tr,null,e.createElement(w.Th,null,e.createElement(h.Z,{variant:"sigma",textColor:"neutral600"},r({id:"global.name",defaultMessage:"Name"}))),e.createElement(w.Th,null,e.createElement(h.Z,{variant:"sigma",textColor:"neutral600"},r({id:"global.description",defaultMessage:"Description"}))),e.createElement(w.Th,null,e.createElement(h.Z,{variant:"sigma",textColor:"neutral600"},r({id:"global.users",defaultMessage:"Users"}))),e.createElement(w.Th,null,e.createElement(oe.T,null,r({id:"global.actions",defaultMessage:"Actions"}))))),e.createElement(xt,{sortedRoles:J,canDelete:V,permissions:i.Z,setRoleToDelete:N,onDelete:[C,y]})):e.createElement(n.x7,{content:Zt[Ut]})),e.createElement(n.QH,{isConfirmButtonLoading:j,onConfirm:jt,onToggleDialog:St,isOpen:C})))},Tt=()=>e.createElement(n.O4,{permissions:i.Z.accessRoles},e.createElement(Pt,null)),Lt=()=>e.createElement(n.O4,{permissions:i.Z.accessRoles},e.createElement(o.rs,null,e.createElement(o.AW,{path:`/settings/${l.Z}/roles/new`,component:lt,exact:!0}),e.createElement(o.AW,{path:`/settings/${l.Z}/roles/:id`,component:ut,exact:!0}),e.createElement(o.AW,{path:`/settings/${l.Z}/roles`,component:Tt,exact:!0}),e.createElement(o.AW,{path:"",component:n.Hn})))},89031:(m,E,t)=>{"use strict";t.d(E,{YX:()=>i,Gc:()=>d,OB:()=>A.Z});var e=t(41609),n=t.n(e);const i=D=>Object.keys(D).reduce((v,L)=>{const h=D[L].controllers,P=Object.keys(h).reduce((T,M)=>(n()(h[M])||(T[M]=h[M]),T),{});return n()(P)||(v[L]={controllers:P}),v},{});var l=t(31498);const d=D=>`/${l.Z}/${D}`;var A=t(84757)},47443:(m,E,t)=>{var e=t(42118);function n(o,i){var l=o==null?0:o.length;return!!l&&e(o,i,0)>-1}m.exports=n},1196:m=>{function E(t,e,n){for(var o=-1,i=t==null?0:t.length;++o<i;)if(n(e,t[o]))return!0;return!1}m.exports=E},20731:(m,E,t)=>{var e=t(88668),n=t(47443),o=t(1196),i=t(29932),l=t(7518),p=t(74757),d=200;function A(D,v,L,h){var P=-1,T=n,M=!0,b=D.length,S=[],U=v.length;if(!b)return S;L&&(v=i(v,l(L))),h?(T=o,M=!1):v.length>=d&&(T=p,M=!1,v=new e(v));e:for(;++P<b;){var Z=D[P],k=L==null?Z:L(Z);if(Z=h||Z!==0?Z:0,M&&k===k){for(var B=U;B--;)if(v[B]===k)continue e;S.push(Z)}else T(v,k,h)||S.push(Z)}return S}m.exports=A},89881:(m,E,t)=>{var e=t(47816),n=t(99291),o=n(e);m.exports=o},41848:m=>{function E(t,e,n,o){for(var i=t.length,l=n+(o?1:-1);o?l--:++l<i;)if(e(t[l],l,t))return l;return-1}m.exports=E},42118:(m,E,t)=>{var e=t(41848),n=t(62722),o=t(42351);function i(l,p,d){return p===p?o(l,p,d):e(l,n,d)}m.exports=i},62722:m=>{function E(t){return t!==t}m.exports=E},69199:(m,E,t)=>{var e=t(89881),n=t(98612);function o(i,l){var p=-1,d=n(i)?Array(i.length):[];return e(i,function(A,D,v){d[++p]=l(A,D,v)}),d}m.exports=o},82689:(m,E,t)=>{var e=t(29932),n=t(97786),o=t(67206),i=t(69199),l=t(71131),p=t(7518),d=t(85022),A=t(6557),D=t(1469);function v(L,h,P){h.length?h=e(h,function(b){return D(b)?function(S){return n(S,b.length===1?b[0]:b)}:b}):h=[A];var T=-1;h=e(h,p(o));var M=i(L,function(b,S,U){var Z=e(h,function(k){return k(b)});return{criteria:Z,index:++T,value:b}});return l(M,function(b,S){return d(b,S,P)})}m.exports=v},71131:m=>{function E(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}m.exports=E},26393:(m,E,t)=>{var e=t(33448);function n(o,i){if(o!==i){var l=o!==void 0,p=o===null,d=o===o,A=e(o),D=i!==void 0,v=i===null,L=i===i,h=e(i);if(!v&&!h&&!A&&o>i||A&&D&&L&&!v&&!h||p&&D&&L||!l&&L||!d)return 1;if(!p&&!A&&!h&&o<i||h&&l&&d&&!p&&!A||v&&l&&d||!D&&d||!L)return-1}return 0}m.exports=n},85022:(m,E,t)=>{var e=t(26393);function n(o,i,l){for(var p=-1,d=o.criteria,A=i.criteria,D=d.length,v=l.length;++p<D;){var L=e(d[p],A[p]);if(L){if(p>=v)return L;var h=l[p];return L*(h=="desc"?-1:1)}}return o.index-i.index}m.exports=n},99291:(m,E,t)=>{var e=t(98612);function n(o,i){return function(l,p){if(l==null)return l;if(!e(l))return o(l,p);for(var d=l.length,A=i?d:-1,D=Object(l);(i?A--:++A<d)&&p(D[A],A,D)!==!1;);return l}}m.exports=n},42351:m=>{function E(t,e,n){for(var o=n-1,i=t.length;++o<i;)if(t[o]===e)return o;return-1}m.exports=E},35161:(m,E,t)=>{var e=t(29932),n=t(67206),o=t(69199),i=t(1469);function l(p,d){var A=i(p)?e:o;return A(p,n(d,3))}m.exports=l},89734:(m,E,t)=>{var e=t(21078),n=t(82689),o=t(5976),i=t(16612),l=o(function(p,d){if(p==null)return[];var A=d.length;return A>1&&i(p,d[0],d[1])?d=[]:A>2&&i(d[0],d[1],d[2])&&(d=[d[0]]),n(p,e(d,1),[])});m.exports=l},13217:(m,E,t)=>{var e=t(14259);function n(o){var i=o==null?0:o.length;return i?e(o,1,i):[]}m.exports=n},69572:(m,E,t)=>{var e=t(14259),n=t(40554);function o(i,l,p){return i&&i.length?(l=p||l===void 0?1:n(l),e(i,0,l<0?0:l)):[]}m.exports=o},82569:(m,E,t)=>{var e=t(20731),n=t(5976),o=t(29246),i=n(function(l,p){return o(l)?e(l,p):[]});m.exports=i},36989:(m,E,t)=>{"use strict";t.d(E,{Z:()=>o});var e=t(85893),n=t(11047);const o=({startActions:i,endActions:l})=>!i&&!l?null:(0,e.jsxs)(n.k,{justifyContent:"space-between",alignItems:"flex-start",paddingBottom:4,paddingLeft:10,paddingRight:10,children:[(0,e.jsx)(n.k,{gap:2,wrap:"wrap",children:i}),(0,e.jsx)(n.k,{gap:2,shrink:0,wrap:"wrap",children:l})]})},49066:(m,E,t)=>{"use strict";t.d(E,{D:()=>o});var e=t(85893),n=t(41580);const o=({children:i})=>(0,e.jsx)(n.x,{paddingLeft:10,paddingRight:10,children:i})},53979:(m,E,t)=>{"use strict";t.d(E,{A:()=>h,T:()=>v});var e=t(85893),n=t(67294),o=t(71997);const i=P=>{const T=(0,n.useRef)(null),[M,b]=(0,n.useState)(!0),S=([U])=>{b(U.isIntersecting)};return(0,n.useEffect)(()=>{const U=T.current,Z=new IntersectionObserver(S,P);return U&&Z.observe(T.current),()=>{U&&Z.disconnect()}},[T,P]),[T,M]};var l=t(79698);const p=(P,T)=>{const M=(0,l.W)(T);(0,n.useLayoutEffect)(()=>{const b=new ResizeObserver(M);return Array.isArray(P)?P.forEach(S=>{S.current&&b.observe(S.current)}):P.current&&b.observe(P.current),()=>{b.disconnect()}},[P,M])};var d=t(41580),A=t(11047),D=t(75515);const v=P=>{const T=(0,n.useRef)(null),[M,b]=(0,n.useState)(null),[S,U]=i({root:null,rootMargin:"0px",threshold:0});return p(S,()=>{S.current&&b(S.current.getBoundingClientRect())}),(0,n.useEffect)(()=>{T.current&&b(T.current.getBoundingClientRect())},[T]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{style:{height:M?.height},ref:S,children:U&&(0,e.jsx)(h,{ref:T,...P})}),!U&&(0,e.jsx)(h,{...P,sticky:!0,width:M?.width})]})};v.displayName="HeaderLayout";const L=(0,o.ZP)(d.x)`
  width: ${({width:P})=>P?`${P/16}rem`:void 0};
  z-index: ${({theme:P})=>P.zIndices[1]};
`,h=n.forwardRef(({navigationAction:P,primaryAction:T,secondaryAction:M,subtitle:b,title:S,sticky:U,width:Z,...k},B)=>{const z=typeof b=="string";return U?(0,e.jsx)(L,{paddingLeft:6,paddingRight:6,paddingTop:3,paddingBottom:3,position:"fixed",top:0,right:0,background:"neutral0",shadow:"tableShadow",width:Z,"data-strapi-header-sticky":!0,children:(0,e.jsxs)(A.k,{justifyContent:"space-between",children:[(0,e.jsxs)(A.k,{children:[P&&(0,e.jsx)(d.x,{paddingRight:3,children:P}),(0,e.jsxs)(d.x,{children:[(0,e.jsx)(D.Z,{variant:"beta",as:"h1",...k,children:S}),z?(0,e.jsx)(D.Z,{variant:"pi",textColor:"neutral600",children:b}):b]}),M?(0,e.jsx)(d.x,{paddingLeft:4,children:M}):null]}),(0,e.jsx)(A.k,{children:T?(0,e.jsx)(d.x,{paddingLeft:2,children:T}):void 0})]})}):(0,e.jsxs)(d.x,{ref:B,paddingLeft:10,paddingRight:10,paddingBottom:8,paddingTop:P?6:8,background:"neutral100","data-strapi-header":!0,children:[P?(0,e.jsx)(d.x,{paddingBottom:2,children:P}):null,(0,e.jsxs)(A.k,{justifyContent:"space-between",children:[(0,e.jsxs)(A.k,{minWidth:0,children:[(0,e.jsx)(D.Z,{as:"h1",variant:"alpha",...k,children:S}),M?(0,e.jsx)(d.x,{paddingLeft:4,children:M}):null]}),T]}),z?(0,e.jsx)(D.Z,{variant:"epsilon",textColor:"neutral600",as:"p",children:b}):b]})})},17034:(m,E,t)=>{"use strict";t.d(E,{A:()=>p});var e=t(85893),n=t(71997),o=t(41580);const i=(0,n.ZP)(o.x)`
  display: grid;
  grid-template-columns: ${({hasSideNav:d})=>d?"auto 1fr":"1fr"};
`,l=(0,n.ZP)(o.x)`
  overflow-x: hidden;
`,p=({sideNav:d,children:A})=>(0,e.jsxs)(i,{hasSideNav:!!d,children:[d,(0,e.jsx)(l,{paddingBottom:10,children:A})]})},185:(m,E,t)=>{"use strict";t.d(E,{o:()=>l});var e=t(85893),n=t(71997),o=t(41580);const i=(0,n.ZP)(o.x)`
  // To prevent global outline on focus visible to force an outline when Main is focused
  &:focus-visible {
    outline: none;
  }
`,l=({labelledBy:p="main-content-title",...d})=>(0,e.jsx)(i,{"aria-labelledby":p,as:"main",id:"main-content",tabIndex:-1,...d})},67109:(m,E,t)=>{"use strict";t.d(E,{Z:()=>o});var e=t(85893);const n=i=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...i,children:(0,e.jsx)("path",{fill:"#212134",d:"M24 13.3a.2.2 0 0 1-.2.2H5.74l8.239 8.239a.2.2 0 0 1 0 .282L12.14 23.86a.2.2 0 0 1-.282 0L.14 12.14a.2.2 0 0 1 0-.282L11.86.14a.2.2 0 0 1 .282 0L13.98 1.98a.2.2 0 0 1 0 .282L5.74 10.5H23.8c.11 0 .2.09.2.2v2.6Z"})}),o=n},78114:(m,E,t)=>{"use strict";t.d(E,{Z:()=>o});var e=t(85893);const n=i=>(0,e.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"1rem",height:"1rem",fill:"none",viewBox:"0 0 24 24",...i,children:(0,e.jsx)("path",{fill:"#212134",fillRule:"evenodd",d:"M2.68 9.192c-.6.276-2.114 1.18-2.306 1.303a.792.792 0 0 0-.374.68v1.65a.797.797 0 0 0 .384.687c.254.16 1.73 1.042 2.306 1.303l.744 1.8c-.24.634-.67 2.333-.72 2.554a.797.797 0 0 0 .216.744l1.167 1.166a.801.801 0 0 0 .744.216l.03-.008c.36-.092 1.946-.498 2.523-.712l1.8.744c.276.6 1.181 2.115 1.304 2.307a.805.805 0 0 0 .679.374h1.649a.797.797 0 0 0 .686-.384c.16-.254 1.042-1.73 1.303-2.306l1.8-.744c.634.24 2.333.67 2.554.72a.797.797 0 0 0 .744-.216l1.166-1.167a.803.803 0 0 0 .216-.744l-.008-.03c-.092-.36-.498-1.946-.712-2.523l.744-1.8c.6-.276 2.115-1.181 2.307-1.304a.804.804 0 0 0 .374-.679v-1.649a.796.796 0 0 0-.382-.679c-.254-.16-1.73-1.041-2.306-1.303l-.744-1.8c.24-.634.67-2.333.72-2.554a.796.796 0 0 0-.216-.744l-1.166-1.173a.802.802 0 0 0-.744-.216l-.03.008c-.361.092-1.947.498-2.524.712l-1.8-.744c-.276-.6-1.18-2.115-1.303-2.307a.803.803 0 0 0-.68-.374h-1.65a.797.797 0 0 0-.68.382c-.16.254-1.041 1.73-1.303 2.306l-1.8.744c-.634-.24-2.333-.67-2.554-.72a.797.797 0 0 0-.744.216L2.921 4.094a.802.802 0 0 0-.216.744l.008.03c.092.361.498 1.947.712 2.524l-.744 1.8ZM12 17a5 5 0 1 0 0-10 5 5 0 0 0 0 10Z",clipRule:"evenodd"})}),o=n}}]);
